# WatchMe 分析設計 README

**デイリー分析 / スポット分析 コンセプト定義**

---

## 1. 全体思想（最重要）

WatchMe の分析は **「出来事を記録する」ためのものではなく、「その日を理解できる状態を生成する」ためのもの**である。

### 重要な原則

- ❌ **ログの羅列では価値にならない**
- ✅ **グラフと文章を見て「今日はこういう1日だった」と直感的に理解できること**
- ✅ **分析は常に単体で完結していなければならない**

この思想を前提として、**スポット分析** と **デイリー分析** は明確に役割を分離する。

---

## 2. スポット分析（Spot Analysis）

### 役割

**「その時間に何が起きていたか」を事実として記録する分析**

### 特徴

- 時間ブロック単位（例：1時間）
- **観測された事実のみを扱う**
- **前後の文脈は持たない**
- 感情・行動・環境の"生データ"に近い

### 含まれる要素

- `vibe_score`
- `behavior`
- `emotion`
- その時間帯の短い状況説明（実況）

### 例（イメージ）

```
外遊びで身体を大きく動かしている。声量が上がり、反応が活発。
```

### 注意点

- ❌ **解釈しない**
- ❌ **1日の中での位置づけを書かない**
- ❌ **「良い」「悪い」「ピーク」などの評価語を使わない**

👉 **スポット分析は「材料」であり、結論ではない**

---

## 3. デイリー分析（Daily Analysis / 累積分析）

### 役割

**「その日がどんな1日だったか」を説明する唯一の文章**

### 最重要原則

✅ **デイリー分析は、毎回それ単体で「その日の完成版」でなければならない**

- **前回のデイリー分析は参照されない**
- ユーザーは：
  - 1日1回しか見ないかもしれない
  - 途中の時間からしか見ないかもしれない
  - **それでも理解できなければならない**

---

## 4. デイリー分析の基本フォーマット

### 構造（必須）

#### 1. 朝の立ち上がり
- 起床時の状態
- テンションの初期値

#### 2. 日中の流れ
- 午前 → 午後への推移
- 活動と疲労のバランス

#### 3. 現在までの到達点
- 回復しているか
- 収束に向かっているか

#### 4. その日の特徴の要約
- 性格・環境との関係
- 安定型か、起伏型か など

**※ 時刻は使ってよいが、時間にフォーカスしない**

---

## 5. デイリー分析の書き方ルール

### ✅ OKな書き方

- 「この日は〜で始まり〜という流れだった」
- 「午前中は〜、午後には〜が見られた」
- 「全体として、この日は〜な1日だった」

### ❌ NGな書き方

- ❌ 「この後〜した」
- ❌ 「前回の分析では〜」
- ❌ 「今は〜している」
- ❌ 実況中継のような書き方
- ❌ スポット分析と同じ内容の羅列

👉 **"過去から現在までを俯瞰した文章"だけを書く**

---

## 6. スポット分析とデイリー分析の関係

| 項目 | スポット分析 | デイリー分析 |
|------|-------------|-------------|
| **視点** | 点 | 線・全体 |
| **時間** | その瞬間 | 朝〜現在 |
| **内容** | 事実 | 解釈 |
| **役割** | 材料 | 結論 |
| **表示** | 補助情報 | メイン情報 |

---

## 7. バーストイベント（Burst Events）

### 定義

**vibe_score が ±30 以上変化した「感情の大きな転換点」**

### 役割

- グラフ上の「山・谷」の原因を説明する
- デイリー分析における重要な分岐点

### データ構造

```json
{
  "time": "HH:MM",
  "event": "スコア変化の理由（日本語）",
  "score_change": -40
}
```

### 使用ルール

- ✅ **大きな変化のみ記録**
- ✅ **数は少なくて良い**
- ✅ **デイリー分析では：その影響が「その日全体にどう作用したか」を解釈する**
- ❌ **バーストイベントをそのまま文章に貼らない**
- ❌ **「いつ起きたか」より「何を生んだか」が重要**

### 補足：累積的な記録

- デイリー分析では、**その時点までに発生したすべてのバーストイベント**が累積的に記録される
- 例：11時にイベント発生 → 11時以降のデイリー分析にはすべてこのイベントが含まれる
- LLM（Profiler API）が実際のシステムで生成する際も同様の仕組み

---

## 8. ペルソナ（観測対象プロファイル）の扱い

### 前提

- ペルソナは**プロンプトとして必ず入力されている**
- 分析はそれを**前提条件として自然に反映させる**

### 注意点

- ❌ **プロファイルをそのまま文章に書かない**
- ✅ **行動のテンポ・回復の仕方・疲れ方として滲ませる**

### 例

- **のんびり** → 回復が穏やか
- **繊細** → 切り替えに時間がかかる
- **活発** → 上下動が大きい

---

## 9. デイリー分析の完成条件

以下をすべて満たしたとき、分析は **「完成」** とみなす。

- ✅ **単体で読んで、その日の全体像がわかる**
- ✅ **グラフと並べて見たとき、違和感がない**
- ✅ **保護者・第三者が「なるほど」と感じる**
- ✅ **途中の時間で見ても破綻しない**
- ✅ **23時時点では、それ以上上書きされない最終版になる**

---

## 10. データフロー（参考）

### Spot分析の生成

```
音声録音 → 特徴量抽出（ASR/SED/SER）
  ↓
Aggregator API（Spotプロンプト生成）
  ↓
Profiler API（LLM分析）
  ↓
spot_results テーブル
```

### Daily分析の生成

```
Spot分析完了（1日分のspot_results蓄積）
  ↓
Aggregator API（Dailyプロンプト生成）
  - spot_resultsから時系列データを集約
  - vibe_scoreの変化からburst_eventsを検出
  ↓
Profiler API（LLM分析）
  - 1日全体の流れを解釈
  - burst_eventsの影響を考慮
  ↓
daily_results テーブル（UPSERT）
```

---

## 11. この README の使い方

- **新しいペルソナを作る前に必ず読む**
- **プロンプト設計・文章生成のチェックリストとして使う**
- **迷ったら「これはスポットか？デイリーか？」を必ず問い直す**

---

**最終更新**: 2026-01-01
**バージョン**: 2.0（デモデータJSON形式対応版）
