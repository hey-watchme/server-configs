# WatchMe ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”»

æœ€çµ‚æ›´æ–°: 2025-11-09 00:45

---

## ğŸ“‹ ç›®æ¬¡

1. [å‰å›ã®è­°è«–ã‚µãƒãƒªãƒ¼](#å‰å›ã®è­°è«–ã‚µãƒãƒªãƒ¼)
2. [ç”»é¢æ§‹æˆã¨ãƒ‡ãƒ¼ã‚¿ã®ä½¿ã‚ã‚Œæ–¹](#ç”»é¢æ§‹æˆã¨ãƒ‡ãƒ¼ã‚¿ã®ä½¿ã‚ã‚Œæ–¹)
3. [å‡¦ç†ãƒ•ãƒ­ãƒ¼ã®æ­£ã—ã„ç†è§£](#å‡¦ç†ãƒ•ãƒ­ãƒ¼ã®æ­£ã—ã„ç†è§£)
4. [ç¾çŠ¶ã®å•é¡Œç‚¹](#ç¾çŠ¶ã®å•é¡Œç‚¹)
5. [æ–°ã—ã„ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ](#æ–°ã—ã„ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ)
6. [ç§»è¡Œè¨ˆç”»](#ç§»è¡Œè¨ˆç”»)
7. [ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ã‚¿ã‚¹ã‚¯](#ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ã‚¿ã‚¹ã‚¯)

---

## ğŸ¯ å‰å›ã®è­°è«–ã‚µãƒãƒªãƒ¼

### è­°è«–ã®èƒŒæ™¯

2025-11-09ã®ç´¯ç©åˆ†æã‚¨ãƒ©ãƒ¼èª¿æŸ»ä¸­ã«ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã®æ ¹æœ¬çš„ãªå•é¡Œã‚’ç™ºè¦‹ï¼š
- `dashboard`ãƒ†ãƒ¼ãƒ–ãƒ«ãŒ4ã¤ã®è²¬å‹™ã‚’æŒã£ã¦ã„ã‚‹ï¼ˆå…¥åŠ›ãƒ»å‡ºåŠ›ãƒ»è¡¨ç¤ºãƒ»ç´ æï¼‰
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ãŒæ··ä¹±ï¼ˆSKIP vs å¤±æ•—ã®åŒºåˆ¥ãŒã§ããªã„ï¼‰
- `summary`ã‚«ãƒ©ãƒ ãŒNULLã«ãªã‚‹å•é¡Œï¼ˆå¿œæ€¥å‡¦ç½®æ¸ˆã¿ï¼‰

### é‡è¦ãªæ±ºå®šäº‹é …

**âœ… DynamoDBã¯ä¸è¦**
- ç†ç”±ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã¾ã ã„ãªã„ã€Supabaseã§ååˆ†ã€è¤‡é›‘ã•ãŒå¢—ã™
- æ±ºå®šï¼šSupabaseã§ã‚·ãƒ³ãƒ—ãƒ«ã«ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆã‚’ã‚„ã‚Šç›´ã™

**âœ… è¨­è¨ˆæ€æƒ³ï¼šå‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’åˆ†ã‘ã‚‹**
- ã‚«ãƒ†ã‚´ãƒªã”ã¨ï¼ˆASR/SED/SERåˆ¥ã€…ï¼‰ã§ã¯ãªãã€å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨
- ãŸã ã—ã€ASR/SED/SERã¯å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—æ•°ãŒç•°ãªã‚‹ï¼ˆå¾Œè¿°ï¼‰

**âœ… ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ä¿å­˜å¿…é ˆ**
- ç†ç”±ï¼šæ¤œè¨¼ãƒ»ãƒ‡ãƒãƒƒã‚°ã§é »ç¹ã«è¦‹ã‚‹ã€å†å®Ÿè¡Œã®å¯èƒ½æ€§
- æ±ºå®šï¼šã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚‚ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚‚ä¿å­˜

**âœ… ç§»è¡Œæ–¹é‡ï¼šæ®µéšçš„ã«é€²ã‚ã‚‹**
- æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ´»ã‹ã™ï¼ˆvibe_whisper, behavior_yamnetç­‰ï¼‰
- æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å¿…è¦æœ€å°é™
- ä¸¦è¡Œé‹ç”¨æœŸé–“ã‚’è¨­ã‘ã‚‹

---

## ğŸ“± ç”»é¢æ§‹æˆã¨ãƒ‡ãƒ¼ã‚¿ã®ä½¿ã‚ã‚Œæ–¹

### iOSã‚¢ãƒ—ãƒªã®ç”»é¢æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“± ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆåˆæœŸç”»é¢ï¼‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ã€ç´¯ç©æƒ…å ±ã€‘                       â”‚
â”‚ ãƒ»ãã®æ™‚ç‚¹ã¾ã§ã®æ°—åˆ†ã‚¹ã‚³ã‚¢          â”‚
â”‚   ï¼ˆdashboard_summary.average_vibeï¼‰
â”‚                                  â”‚
â”‚ ãƒ»ç·åˆè©•ä¾¡ã‚³ãƒ¡ãƒ³ãƒˆ                 â”‚
â”‚   ï¼ˆdashboard_summary.overall_summaryï¼‰
â”‚                                  â”‚
â”‚ â€»ã“ã‚Œã‚‰ã¯ã‚µãƒ¼ãƒãƒ¼å´ã®ç´¯ç©åˆ†æçµæœ   â”‚
â”‚                                  â”‚
â”‚ ã€æ¦‚è¦è¡¨ç¤ºã€‘                       â”‚
â”‚ ãƒ»éŸ³éŸ¿ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°          â”‚
â”‚ ãƒ»æ„Ÿæƒ…åˆ†å¸ƒ                        â”‚
â”‚ â€»ã‚¢ãƒ—ãƒªå´ã§è¨ˆç®—ã—ã¦è¡¨ç¤º            â”‚
â”‚                                  â”‚
â”‚ [ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ä¸€è¦§ã‚’è¦‹ã‚‹] ãƒœã‚¿ãƒ³    â”‚
â”‚ [æ°—åˆ†è©³ç´°ã‚’è¦‹ã‚‹] ãƒœã‚¿ãƒ³            â”‚
â”‚ [è¡Œå‹•è©³ç´°ã‚’è¦‹ã‚‹] ãƒœã‚¿ãƒ³            â”‚
â”‚ [æ„Ÿæƒ…è©³ç´°ã‚’è¦‹ã‚‹] ãƒœã‚¿ãƒ³            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ ã‚¿ãƒƒãƒ—
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ä¸€è¦§ç”»é¢           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 09:00-09:30                      â”‚
â”‚ ãƒ»ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã‚µãƒãƒªãƒ¼            â”‚
â”‚   ï¼ˆtimeblock_vibe.summaryï¼‰      â”‚
â”‚ ãƒ»ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£                   â”‚
â”‚ ãƒ»ã‚¹ã‚³ã‚¢                          â”‚
â”‚   ï¼ˆtimeblock_vibe.vibe_scoreï¼‰   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 09:30-10:00                      â”‚
â”‚ ...                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ åˆ¥ãƒ«ãƒ¼ãƒˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š æ°—åˆ†è©³ç´°ç”»é¢                    â”‚
â”‚    ï¼ˆtimeblock_vibeå…¨ä»¶ï¼‰          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š è¡Œå‹•è©³ç´°ç”»é¢                    â”‚
â”‚    ï¼ˆbehavior_summaryå…¨ä»¶ï¼‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š æ„Ÿæƒ…è©³ç´°ç”»é¢                    â”‚
â”‚    ï¼ˆemotion_summaryå…¨ä»¶ï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ åˆ¥ãƒ«ãƒ¼ãƒˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ˆ ãƒ¬ãƒãƒ¼ãƒˆç”»é¢                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ã€é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã€‘                   â”‚
â”‚ æœˆ ç« æ°´ æœ¨ é‡‘ åœŸ æ—¥               â”‚
â”‚ 75 80 70 65 85 90 88             â”‚
â”‚ â€»7æ—¥åˆ†ã®dashboard_summary.average_vibe
â”‚                                  â”‚
â”‚ ã€æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆã€‘                   â”‚
â”‚ 11/1: 75, 11/2: 80, ...ï¼ˆ30å€‹ï¼‰ â”‚
â”‚ â€»30æ—¥åˆ†ã®dashboard_summary.average_vibe
â”‚                                  â”‚
â”‚ ã€å¹´æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã€‘                   â”‚
â”‚ 1æœˆ: 75, 2æœˆ: 80, ...ï¼ˆ12å€‹ï¼‰    â”‚
â”‚ â€»å„æœˆã®average_vibeã‚’ã‚¢ãƒ—ãƒªå´ã§å¹³å‡ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ã®3ã¤ã®æŸ±

**æ°—åˆ†ï¼ˆVibeï¼‰** / **è¡Œå‹•ï¼ˆBehaviorï¼‰** / **æ„Ÿæƒ…ï¼ˆEmotionï¼‰** ã¯**åˆ¥ã€…ã®æŸ±**

- å„æŸ±ã”ã¨ã«è©³ç´°ç”»é¢ãŒã‚ã‚‹
- ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ä¸€è¦§ã§ã¯ä¸»ã«ã€Œæ°—åˆ†ã€ã‚’è¡¨ç¤º
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã¯3ã¤ã‚’ã¾ã¨ã‚ã¦è¡¨ç¤ºï¼ˆã‚¢ãƒ—ãƒªå´ã§é›†è¨ˆï¼‰

---

## ğŸ”„ å‡¦ç†ãƒ•ãƒ­ãƒ¼ã®æ­£ã—ã„ç†è§£

### é‡è¦ãªç™ºè¦‹ï¼šå‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—æ•°ãŒç•°ãªã‚‹

| ã‚«ãƒ†ã‚´ãƒª | ã‚¹ãƒ†ãƒƒãƒ—æ•° | è©³ç´° |
|---------|----------|------|
| **ASRï¼ˆæ°—åˆ†ï¼‰** | **3ã‚¹ãƒ†ãƒƒãƒ—** | Transcriber â†’ Aggregator(prompt) â†’ Scorer |
| **SEDï¼ˆè¡Œå‹•ï¼‰** | **2ã‚¹ãƒ†ãƒƒãƒ—** | Features â†’ Aggregator |
| **SERï¼ˆæ„Ÿæƒ…ï¼‰** | **2ã‚¹ãƒ†ãƒƒãƒ—** | Features â†’ Aggregator |

---

### æ°—åˆ†ï¼ˆVibeï¼‰ï¼š3ã‚¹ãƒ†ãƒƒãƒ—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Vibe Transcriber           â”‚
â”‚ ï¼ˆAzure Speech APIï¼‰                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…¥åŠ›: audio.wav                    â”‚
â”‚ å‡ºåŠ›: transcriptionï¼ˆæ–‡å­—èµ·ã“ã—ï¼‰    â”‚
â”‚ çŠ¶æ…‹: ã€ç´ æã€éè¡¨ç¤ºã€‘               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Vibe Aggregator            â”‚
â”‚ ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼‰                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…¥åŠ›:                              â”‚
â”‚ - transcription                    â”‚
â”‚ - æ—¥æ™‚ãƒ»æ›œæ—¥ãƒ»å­£ç¯€                  â”‚
â”‚ - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«              â”‚
â”‚                                    â”‚
â”‚ å‡ºåŠ›: promptï¼ˆChatGPTç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰ â”‚
â”‚ çŠ¶æ…‹: ã€ç´ æã€å†…éƒ¨ãƒ‡ãƒ¼ã‚¿ã€éè¡¨ç¤ºã€‘   â”‚
â”‚                                    â”‚
â”‚ âš ï¸ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ä¿å­˜å¿…é ˆ             â”‚
â”‚ ï¼ˆæ¤œè¨¼ãƒ»ãƒ‡ãƒãƒƒã‚°ãƒ»å†å®Ÿè¡Œã§ä½¿ç”¨ï¼‰     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Vibe Scorer                â”‚
â”‚ ï¼ˆChatGPTåˆ†æï¼‰                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…¥åŠ›: prompt                       â”‚
â”‚                                    â”‚
â”‚ å‡ºåŠ›:                              â”‚
â”‚ - vibe_scoreï¼ˆæ°—åˆ†ã‚¹ã‚³ã‚¢ï¼‰          â”‚
â”‚ - summaryï¼ˆã‚³ãƒ¡ãƒ³ãƒˆï¼‰               â”‚
â”‚ - burst_eventsï¼ˆã‚¤ãƒ™ãƒ³ãƒˆï¼‰          â”‚
â”‚                                    â”‚
â”‚ çŠ¶æ…‹: ã€åˆã‚ã¦è¡¨ç¤ºå¯èƒ½ãƒ‡ãƒ¼ã‚¿ã«ãªã‚‹ã€‘ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### è¡Œå‹•ï¼ˆBehaviorï¼‰ï¼š2ã‚¹ãƒ†ãƒƒãƒ—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Behavior Features          â”‚
â”‚ ï¼ˆéŸ³éŸ¿ã‚¤ãƒ™ãƒ³ãƒˆæ¤œå‡ºï¼‰                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…¥åŠ›: audio.wav                    â”‚
â”‚ å‡ºåŠ›: éŸ³éŸ¿ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆ527ç¨®é¡ï¼‰        â”‚
â”‚ çŠ¶æ…‹: ã€ç´ æã€éè¡¨ç¤ºã€‘               â”‚
â”‚                                    â”‚
â”‚ ãƒ†ãƒ¼ãƒ–ãƒ«: behavior_yamnetï¼ˆæ—¢å­˜ï¼‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Behavior Aggregator        â”‚
â”‚ ï¼ˆè¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æï¼‰                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…¥åŠ›: behavior_yamnet              â”‚
â”‚                                    â”‚
â”‚ å‡ºåŠ›: behavior_summary             â”‚
â”‚ - speech: 80%                      â”‚
â”‚ - music: 10%                       â”‚
â”‚ - background_noise: 5%             â”‚
â”‚                                    â”‚
â”‚ çŠ¶æ…‹: ã€è¡¨ç¤ºå¯èƒ½ãƒ‡ãƒ¼ã‚¿ã«ãªã‚‹ã€‘       â”‚
â”‚                                    â”‚
â”‚ ãƒ†ãƒ¼ãƒ–ãƒ«: behavior_summaryï¼ˆæ—¢å­˜ï¼‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ„Ÿæƒ…ï¼ˆEmotionï¼‰ï¼š2ã‚¹ãƒ†ãƒƒãƒ—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Emotion Features           â”‚
â”‚ ï¼ˆæ„Ÿæƒ…èªè­˜ï¼‰                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…¥åŠ›: audio.wav                    â”‚
â”‚ å‡ºåŠ›: 8æ„Ÿæƒ…ã‚¹ã‚³ã‚¢                   â”‚
â”‚ çŠ¶æ…‹: ã€ç´ æã€éè¡¨ç¤ºã€‘               â”‚
â”‚                                    â”‚
â”‚ ãƒ†ãƒ¼ãƒ–ãƒ«: emotion_opensmileï¼ˆæ—¢å­˜ï¼‰ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Emotion Aggregator         â”‚
â”‚ ï¼ˆæ„Ÿæƒ…é›†è¨ˆï¼‰                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…¥åŠ›: emotion_opensmile            â”‚
â”‚                                    â”‚
â”‚ å‡ºåŠ›: emotion_summary              â”‚
â”‚ - happy: 70%                       â”‚
â”‚ - neutral: 20%                     â”‚
â”‚ - sad: 10%                         â”‚
â”‚                                    â”‚
â”‚ çŠ¶æ…‹: ã€è¡¨ç¤ºå¯èƒ½ãƒ‡ãƒ¼ã‚¿ã«ãªã‚‹ã€‘       â”‚
â”‚                                    â”‚
â”‚ ãƒ†ãƒ¼ãƒ–ãƒ«: emotion_opensmile_summaryï¼ˆæ—¢å­˜ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ç´¯ç©åˆ†æï¼š3ã¤æƒã£ã¦ã‹ã‚‰å®Ÿè¡Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ã¤ã®æŸ±ãŒæƒã£ãŸçŠ¶æ…‹                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… timeblock_vibe.status = 'scored' â”‚
â”‚ âœ… behavior_summary ãŒå­˜åœ¨           â”‚
â”‚ âœ… emotion_summary ãŒå­˜åœ¨            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Dashboard Summary API      â”‚
â”‚ ï¼ˆç´¯ç©ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼‰               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…¥åŠ›:                              â”‚
â”‚ - ãã®æ—¥ã®å…¨ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯          â”‚
â”‚   ï¼ˆtimeblock_vibeå…¨ä»¶ï¼‰            â”‚
â”‚ - behavior_summary                 â”‚
â”‚ - emotion_summary                  â”‚
â”‚                                    â”‚
â”‚ å‡ºåŠ›: ç´¯ç©ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ                â”‚
â”‚                                    â”‚
â”‚ ãƒ†ãƒ¼ãƒ–ãƒ«: dashboard_summary         â”‚
â”‚ ã‚«ãƒ©ãƒ : prompt                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Dashboard Analysis API     â”‚
â”‚ ï¼ˆChatGPTç´¯ç©åˆ†æï¼‰                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…¥åŠ›: dashboard_summary.prompt     â”‚
â”‚                                    â”‚
â”‚ å‡ºåŠ›:                              â”‚
â”‚ - overall_summaryï¼ˆ1æ—¥ã®ç·è©•ï¼‰     â”‚
â”‚ - hourly_summariesï¼ˆæ™‚é–“å¸¯åˆ¥ï¼‰     â”‚
â”‚ - emotion_trends                   â”‚
â”‚ - behavioral_patterns              â”‚
â”‚                                    â”‚
â”‚ ãƒ†ãƒ¼ãƒ–ãƒ«: dashboard_summary         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš¨ ç¾çŠ¶ã®å•é¡Œç‚¹

### å•é¡Œ1ï¼š`dashboard`ãƒ†ãƒ¼ãƒ–ãƒ«ã®è²¬å‹™éå¤š

**ç¾çŠ¶**ï¼š
```
dashboard ãƒ†ãƒ¼ãƒ–ãƒ«ãŒ4ã¤ã®å½¹å‰²ã‚’æŒã£ã¦ã„ã‚‹
â”œâ”€ ã€è²¬å‹™1ã€‘ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ ¼ç´ï¼ˆå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ï¼‰â† Vibe Aggregatorã®å‡ºåŠ›
â”œâ”€ ã€è²¬å‹™2ã€‘åˆ†æçµæœæ ¼ç´ï¼ˆå‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ï¼‰â† Vibe Scorerã®å‡ºåŠ›
â”œâ”€ ã€è²¬å‹™3ã€‘iOSã‚¢ãƒ—ãƒªã®è¡¨ç¤ºç”¨ãƒ‡ãƒ¼ã‚¿  â† ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ä¸€è¦§ç”»é¢ã§ä½¿ç”¨
â””â”€ ã€è²¬å‹™4ã€‘ç´¯ç©åˆ†æã®ç´ æï¼ˆæ¬¡ã®å‡¦ç†ã®å…¥åŠ›ï¼‰â† Dashboard Summary APIã®å…¥åŠ›
```

**å•é¡Œç‚¹**ï¼š
- âœ… å…¥åŠ›ï¼ˆpromptï¼‰ã¨å‡ºåŠ›ï¼ˆvibe_scoreï¼‰ãŒæ··åœ¨
- âœ… `status`ãŒä½•ã‚’è¡¨ã™ã®ã‹ä¸æ˜ç¢º
  - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆå®Œäº†ï¼Ÿ
  - ChatGPTåˆ†æå®Œäº†ï¼Ÿ
  - ç´¯ç©å‡¦ç†å®Œäº†ï¼Ÿ
- âœ… å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—ãŒè¦‹ãˆãªã„ï¼ˆ3ã‚¹ãƒ†ãƒƒãƒ—ã‚ã‚‹ã®ã«1ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

---

### å•é¡Œ2ï¼šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ã®æ··ä¹±

**ç¾çŠ¶**ï¼š
```sql
-- 3ã¤ã®ç•°ãªã‚‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä½“ç³»ãŒæ··åœ¨
audio_files.transcriptions_status: pending, skipped, completed, quota_exceeded
dashboard.status: pending, completed, failed
dashboard.vibe_score:
  - NULL = æœªå‡¦ç†
  - 0 = å¤±æ•—ã¾ãŸã¯SKIP  â† âš ï¸ åŒºåˆ¥ã§ããªã„
  - æ•°å€¤ = æˆåŠŸ
```

**å•é¡Œç‚¹**ï¼š
- âœ… SKIPã¨å¤±æ•—ã‚’åŒºåˆ¥ã§ããªã„ï¼ˆä¸¡æ–¹`vibe_score=0`ï¼‰
- âœ… `status`ã¨`vibe_score`ã®å½¹å‰²ãŒé‡è¤‡
- âœ… ã©ã®ã‚¹ãƒ†ãƒƒãƒ—ã¾ã§é€²ã‚“ã ã‹ã‚ã‹ã‚‰ãªã„
  - transcriptionå®Œäº†ã—ãŸã‘ã©promptæœªä½œæˆï¼Ÿ
  - promptä½œæˆã—ãŸã‘ã©ã‚¹ã‚³ã‚¢æœªç®—å‡ºï¼Ÿ

---

### å•é¡Œ3ï¼šSKIPã‚’ã€Œå¤±æ•—ã€ã¨ã—ã¦æ‰±ã†ä¸è‡ªç„¶ã•

**ç¾çŠ¶ã®ã‚³ãƒ¼ãƒ‰**ï¼š
```python
# lambda_function.py Line 122-154
if status == 'skipped':
    # create-failed-record ã‚’å‘¼ã¶ â† âš ï¸ SKIPã¯å¤±æ•—ã˜ã‚ƒãªã„
    response = requests.post(
        f"{API_BASE_URL}/vibe-analysis/aggregator/create-failed-record",
        params={
            "failure_reason": "night_skip",  # â† å¤±æ•—ã˜ã‚ƒãªãã¦ä»•æ§˜
            "error_message": "Skipped during quiet hours (23:00-05:59)"
        }
    )
```

**å•é¡Œç‚¹**ï¼š
- SKIPã¯**ä»•æ§˜é€šã‚Šã®å‹•ä½œ**ã§ã‚ã‚Šã€**å¤±æ•—ã§ã¯ãªã„**
- `create-failed-record`ã¨ã„ã†ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåãŒä¸é©åˆ‡
- ç´¯ç©åˆ†æã§ã€Œå¤±æ•—ãƒ¬ã‚³ãƒ¼ãƒ‰ã€ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹æ··ä¹±

---

### å•é¡Œ4ï¼š`summary`ã‚«ãƒ©ãƒ ã®NULLå•é¡Œ

**æ ¹æœ¬åŸå› **ï¼š
```python
# main.py Line 472ï¼ˆ2025-11-09ã«å¿œæ€¥å‡¦ç½®æ¸ˆã¿ï¼‰
summary = block.get("summary") or ""  # NULLã®å ´åˆç©ºæ–‡å­—åˆ—ã«å¤‰æ›
```

**ãªãœNULLã«ãªã‚‹ã®ã‹**ï¼š
- `create-failed-record`ãŒ`summary`ã‚’è¨­å®šã—ã¦ã„ãªã„
- ãƒ‡ãƒ¼ã‚¿åˆ¶ç´„ãŒå­˜åœ¨ã—ãªã„
- å¤±æ•—æ™‚ã®æŒ™å‹•ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„

---

### å•é¡Œ5ï¼šå‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—ãŒè¦‹ãˆãªã„

**ç¾çŠ¶**ï¼š
- ASRã¯3ã‚¹ãƒ†ãƒƒãƒ—ã‚ã‚‹ã®ã«ã€é€”ä¸­çµŒéãŒè¦‹ãˆãªã„
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãŒã€ã©ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚ã‚‹ã‹ä¸æ˜ç¢º
- transcriptionãŒã©ã“ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹ä¸æ˜ç¢ºï¼ˆvibe_whisperï¼Ÿï¼‰

---

## ğŸ¯ æ–°ã—ã„ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ

### è¨­è¨ˆæ€æƒ³

**åŸå‰‡1ï¼š1ãƒ†ãƒ¼ãƒ–ãƒ« = 1å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—**
- ãŸã ã—ã€æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã¯æ´»ã‹ã™
- æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å¿…è¦æœ€å°é™

**åŸå‰‡2ï¼šå‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†**
- `status`ã‚«ãƒ©ãƒ ã§ç¾åœ¨ã®å‡¦ç†çŠ¶æ…‹ã‚’æ˜ç¤º
- æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸ã®é€²è¡Œæ¡ä»¶ã‚’æ˜ç¢ºåŒ–

**åŸå‰‡3ï¼šç´ æã¨è¡¨ç¤ºç”¨ãƒ‡ãƒ¼ã‚¿ã®åˆ†é›¢**
- ç´ æï¼štranscription, promptç­‰ï¼ˆæ¤œè¨¼ãƒ»å†å®Ÿè¡Œç”¨ï¼‰
- è¡¨ç¤ºç”¨ï¼švibe_score, summaryç­‰ï¼ˆã‚¢ãƒ—ãƒªè¡¨ç¤ºç”¨ï¼‰
- ä¸¡æ–¹ã¨ã‚‚ä¿å­˜ã™ã‚‹

---

### ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆï¼ˆå…¨ä½“åƒï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ°—åˆ†ï¼ˆVibeï¼‰ç³»çµ±                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ vibe_whisperï¼ˆæ—¢å­˜ï¼‰                 â”‚ â† Step 1: transcription
â”‚ ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚‚ä¿å­˜ï¼Ÿï¼‰                â”‚ â† Step 2: prompt
â”‚                                     â”‚
â”‚ timeblock_vibeï¼ˆæ–°è¦ï¼‰               â”‚ â† Step 1-3 å…¨ã¦
â”‚ - transcription                     â”‚   ï¼ˆçµ±åˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
â”‚ - prompt                            â”‚
â”‚ - vibe_score + summary              â”‚
â”‚ - status                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¡Œå‹•ï¼ˆBehaviorï¼‰ç³»çµ±                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ behavior_yamnetï¼ˆæ—¢å­˜ï¼‰              â”‚ â† Step 1: ç´ æ
â”‚ behavior_summaryï¼ˆæ—¢å­˜ï¼‰             â”‚ â† Step 2: è¡¨ç¤ºç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ„Ÿæƒ…ï¼ˆEmotionï¼‰ç³»çµ±                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ emotion_opensmileï¼ˆæ—¢å­˜ï¼‰            â”‚ â† Step 1: ç´ æ
â”‚ emotion_opensmile_summaryï¼ˆæ—¢å­˜ï¼‰    â”‚ â† Step 2: è¡¨ç¤ºç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç´¯ç©åˆ†æ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ dashboard_summaryï¼ˆæ—¢å­˜ã€ä¿®æ­£ï¼‰      â”‚ â† ãƒ¬ãƒãƒ¼ãƒˆç”»é¢ã§ä½¿ç”¨
â”‚ - status ã‚«ãƒ©ãƒ è¿½åŠ                   â”‚
â”‚ - prompt ä¿å­˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—§ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ®µéšçš„ã«å»ƒæ­¢ï¼‰            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ dashboardï¼ˆPhase 5ã§å‰Šé™¤ï¼‰           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ãƒ†ãƒ¼ãƒ–ãƒ«1: `timeblock_vibe`ï¼ˆæ–°è¦ä½œæˆã€é‡è¦ï¼‰

**å½¹å‰²**ï¼šæ°—åˆ†ï¼ˆVibeï¼‰ã®3ã‚¹ãƒ†ãƒƒãƒ—å…¨ã¦ã‚’1ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç®¡ç†

```sql
CREATE TABLE timeblock_vibe (
  device_id UUID NOT NULL,
  date DATE NOT NULL,
  time_block TEXT NOT NULL,

  -- ========================================
  -- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ï¼ˆå‡¦ç†ã®é€²è¡ŒçŠ¶æ…‹ï¼‰
  -- ========================================
  status TEXT NOT NULL DEFAULT 'pending'
    CHECK (status IN (
      'pending',        -- æœªå‡¦ç†ï¼ˆéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«å¾…ã¡ï¼‰
      'transcribing',   -- Step 1å®Ÿè¡Œä¸­
      'transcribed',    -- Step 1å®Œäº†ã€Step 2å¾…ã¡
      'generating',     -- Step 2å®Ÿè¡Œä¸­ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼‰
      'prompt_ready',   -- Step 2å®Œäº†ã€Step 3å¾…ã¡
      'scoring',        -- Step 3å®Ÿè¡Œä¸­ï¼ˆChatGPTåˆ†æï¼‰
      'completed',      -- Step 3å®Œäº†ï¼ˆå…¨ã‚¹ãƒ†ãƒƒãƒ—å®Œäº†ï¼‰
      'failed',         -- å¤±æ•—
      'skipped'         -- å¤œé–“ã‚¹ã‚­ãƒƒãƒ—ï¼ˆ23:00-05:59ï¼‰
    )),

  -- å¤±æ•—æƒ…å ±ï¼ˆstatus='failed'ã®å ´åˆã®ã¿ï¼‰
  failure_reason TEXT
    CHECK (failure_reason IN ('quota_exceeded', 'timeout', 'api_error', 'network_error', NULL)),
  error_message TEXT,

  -- ========================================
  -- Step 1: Vibe Transcriber ã®çµæœï¼ˆç´ æï¼‰
  -- ========================================
  transcription TEXT,
  transcribed_at TIMESTAMP WITH TIME ZONE,

  -- ========================================
  -- Step 2: Vibe Aggregator ã®çµæœï¼ˆç´ æã€ä¿å­˜å¿…é ˆï¼‰
  -- ========================================
  prompt TEXT,  -- ChatGPTç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆæ¤œè¨¼ãƒ»ãƒ‡ãƒãƒƒã‚°ã§é »ç¹ã«ä½¿ç”¨ï¼‰
  prompt_generated_at TIMESTAMP WITH TIME ZONE,

  -- ========================================
  -- Step 3: Vibe Scorer ã®çµæœï¼ˆè¡¨ç¤ºç”¨ï¼‰
  -- ========================================
  vibe_score INTEGER CHECK (vibe_score BETWEEN -100 AND 100),
  summary TEXT,  -- ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚³ãƒ¡ãƒ³ãƒˆ
  burst_events JSONB,  -- æ„Ÿæƒ…å¤‰åŒ–ã®ã‚¤ãƒ™ãƒ³ãƒˆ
  analysis_result JSONB,  -- ãã®ä»–ã®åˆ†æçµæœ
  analyzed_at TIMESTAMP WITH TIME ZONE,

  -- ========================================
  -- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  -- ========================================
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

  PRIMARY KEY (device_id, date, time_block),

  -- ========================================
  -- ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§åˆ¶ç´„
  -- ========================================

  -- completedã®å ´åˆã€å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒæƒã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹
  CONSTRAINT check_completed_has_all_data CHECK (
    (status = 'completed' AND
     transcription IS NOT NULL AND
     prompt IS NOT NULL AND
     vibe_score IS NOT NULL AND
     summary IS NOT NULL) OR
    (status != 'completed')
  ),

  -- failedã®å ´åˆã€failure_reasonãŒå¿…è¦
  CONSTRAINT check_failed_has_reason CHECK (
    (status = 'failed' AND failure_reason IS NOT NULL) OR
    (status != 'failed')
  ),

  -- skippedã®å ´åˆã€åˆ†æçµæœã¯NULL
  CONSTRAINT check_skipped_no_analysis CHECK (
    (status = 'skipped' AND vibe_score IS NULL AND prompt IS NULL) OR
    (status != 'skipped')
  )
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_timeblock_vibe_device_date
  ON timeblock_vibe(device_id, date);

CREATE INDEX idx_timeblock_vibe_status
  ON timeblock_vibe(status)
  WHERE status IN ('pending', 'transcribed', 'prompt_ready');  -- å‡¦ç†å¾…ã¡ã®ã‚‚ã®ã ã‘

-- updated_atè‡ªå‹•æ›´æ–°
CREATE TRIGGER update_timeblock_vibe_updated_at
  BEFORE UPDATE ON timeblock_vibe
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();
```

**ãƒ‡ãƒ¼ã‚¿ä¾‹ï¼ˆå®Œäº†ï¼‰**ï¼š
```json
{
  "device_id": "9f7d6e27-98c3-4c19-bdfb-f7fda58b9a93",
  "date": "2025-11-09",
  "time_block": "09-00",
  "status": "completed",

  "transcription": "ãŠã¯ã‚ˆã†ã€‚ä»Šæ—¥ã¯è‰¯ã„å¤©æ°—ã ã­ã€‚æ•£æ­©ã«è¡Œã“ã†ã‹ã€‚",
  "transcribed_at": "2025-11-09T09:01:00Z",

  "prompt": "ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å¿ƒç†çŠ¶æ…‹ã‚’åˆ†æã—ã¦ãã ã•ã„...\nç™ºè©±å†…å®¹: ãŠã¯ã‚ˆã†ã€‚ä»Šæ—¥ã¯è‰¯ã„å¤©æ°—ã ã­ã€‚...",
  "prompt_generated_at": "2025-11-09T09:02:00Z",

  "vibe_score": 75,
  "summary": "ãƒã‚¸ãƒ†ã‚£ãƒ–ãªä¼šè©±ãŒå¤šãã€ç©ã‚„ã‹ãªé›°å›²æ°—ã€‚å¤–å‡ºã¸ã®æ„æ¬²ãŒè¦‹ã‚‰ã‚Œã‚‹ã€‚",
  "burst_events": [...],
  "analyzed_at": "2025-11-09T09:03:00Z"
}
```

**ãƒ‡ãƒ¼ã‚¿ä¾‹ï¼ˆSKIPï¼‰**ï¼š
```json
{
  "device_id": "9f7d6e27-98c3-4c19-bdfb-f7fda58b9a93",
  "date": "2025-11-09",
  "time_block": "00-00",
  "status": "skipped",
  "summary": "å¤œé–“ä¼‘æ­¢æ™‚é–“ï¼ˆ23:00-05:59ï¼‰",
  "transcription": null,
  "prompt": null,
  "vibe_score": null
}
```

**ãƒ‡ãƒ¼ã‚¿ä¾‹ï¼ˆå¤±æ•—ï¼‰**ï¼š
```json
{
  "device_id": "9f7d6e27-98c3-4c19-bdfb-f7fda58b9a93",
  "date": "2025-11-09",
  "time_block": "09-00",
  "status": "failed",
  "failure_reason": "quota_exceeded",
  "error_message": "Azure Speech API quota exceeded",
  "transcription": null,
  "prompt": null,
  "vibe_score": null
}
```

---

### ãƒ†ãƒ¼ãƒ–ãƒ«2: `behavior_yamnet`ï¼ˆæ—¢å­˜ã€å¤‰æ›´ãªã—ï¼‰

**å½¹å‰²**ï¼šè¡Œå‹•ï¼ˆBehaviorï¼‰ã®Step 1ï¼ˆç´ æï¼‰

æ—¢å­˜ã®ã¾ã¾ã§ä½¿ç”¨ã€‚

---

### ãƒ†ãƒ¼ãƒ–ãƒ«3: `behavior_summary`ï¼ˆæ—¢å­˜ã€å¤‰æ›´ãªã—ï¼‰

**å½¹å‰²**ï¼šè¡Œå‹•ï¼ˆBehaviorï¼‰ã®Step 2ï¼ˆè¡¨ç¤ºç”¨ï¼‰

æ—¢å­˜ã®ã¾ã¾ã§ä½¿ç”¨ã€‚

---

### ãƒ†ãƒ¼ãƒ–ãƒ«4: `emotion_opensmile`ï¼ˆæ—¢å­˜ã€å¤‰æ›´ãªã—ï¼‰

**å½¹å‰²**ï¼šæ„Ÿæƒ…ï¼ˆEmotionï¼‰ã®Step 1ï¼ˆç´ æï¼‰

æ—¢å­˜ã®ã¾ã¾ã§ä½¿ç”¨ã€‚

---

### ãƒ†ãƒ¼ãƒ–ãƒ«5: `emotion_opensmile_summary`ï¼ˆæ—¢å­˜ã€å¤‰æ›´ãªã—ï¼‰

**å½¹å‰²**ï¼šæ„Ÿæƒ…ï¼ˆEmotionï¼‰ã®Step 2ï¼ˆè¡¨ç¤ºç”¨ï¼‰

æ—¢å­˜ã®ã¾ã¾ã§ä½¿ç”¨ã€‚

---

### ãƒ†ãƒ¼ãƒ–ãƒ«6: `dashboard_summary`ï¼ˆæ—¢å­˜ã€ä¿®æ­£ï¼‰

**å½¹å‰²**ï¼šç´¯ç©åˆ†æçµæœï¼ˆãƒ¬ãƒãƒ¼ãƒˆç”»é¢ã§ä½¿ç”¨ï¼‰

```sql
-- æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ–°ã—ã„ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
ALTER TABLE dashboard_summary
  -- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¿½åŠ ï¼ˆç´¯ç©åˆ†æã®å‡¦ç†çŠ¶æ…‹ï¼‰
  ADD COLUMN IF NOT EXISTS status TEXT DEFAULT 'pending'
    CHECK (status IN ('pending', 'prompt_ready', 'analyzing', 'completed', 'failed')),

  -- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—è¿½åŠ 
  ADD COLUMN IF NOT EXISTS prompt_generated_at TIMESTAMP WITH TIME ZONE,
  ADD COLUMN IF NOT EXISTS analyzed_at TIMESTAMP WITH TIME ZONE;

-- ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
COMMENT ON COLUMN dashboard_summary.status IS
  'ç´¯ç©åˆ†æã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆtimeblock_vibeã®statusã¨ã¯ç‹¬ç«‹ï¼‰
   - pending: æœªå‡¦ç†
   - prompt_ready: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆå®Œäº†ã€ChatGPTåˆ†æå¾…ã¡
   - analyzing: ChatGPTåˆ†æä¸­
   - completed: åˆ†æå®Œäº†
   - failed: åˆ†æå¤±æ•—';

COMMENT ON COLUMN dashboard_summary.prompt IS
  'Dashboard Summary API ãŒç”Ÿæˆã—ãŸç´¯ç©ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã€æ¤œè¨¼ãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨ã«ä¿å­˜ï¼‰';

COMMENT ON COLUMN dashboard_summary.overall_summary IS
  'Dashboard Analysis API ãŒç”Ÿæˆã—ãŸ1æ—¥ã®ç·è©•ï¼ˆå‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ï¼‰';

COMMENT ON COLUMN dashboard_summary.average_vibe IS
  '1æ—¥ã®å¹³å‡æ°—åˆ†ã‚¹ã‚³ã‚¢ï¼ˆãƒ¬ãƒãƒ¼ãƒˆç”»é¢ã§ä½¿ç”¨ï¼‰
   é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ: 7æ—¥åˆ†ã®ã“ã®å€¤ã‚’è¡¨ç¤º
   æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ: 30æ—¥åˆ†ã®ã“ã®å€¤ã‚’è¡¨ç¤º
   å¹´æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ: 12ãƒ¶æœˆåˆ†ã‚’ã‚¢ãƒ—ãƒªå´ã§å¹³å‡';
```

**æ—¢å­˜ã‚«ãƒ©ãƒ **ï¼š
```sql
CREATE TABLE dashboard_summary (
  device_id UUID NOT NULL,
  date DATE NOT NULL,

  -- ========================================
  -- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆNEWï¼‰
  -- ========================================
  status TEXT DEFAULT 'pending',

  -- ========================================
  -- ç´¯ç©ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆå…¥åŠ›ã€NEWï¼‰
  -- ========================================
  prompt TEXT,
  prompt_generated_at TIMESTAMP WITH TIME ZONE,

  -- ========================================
  -- ç´¯ç©åˆ†æçµæœï¼ˆå‡ºåŠ›ï¼‰
  -- ========================================
  overall_summary TEXT,  -- 1æ—¥ã®ç·è©•
  hourly_summaries JSONB,  -- æ™‚é–“å¸¯åˆ¥ã‚µãƒãƒªãƒ¼
  emotion_trends JSONB,  -- æ„Ÿæƒ…ã®æ¨ç§»
  behavioral_patterns JSONB,  -- è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³
  analyzed_at TIMESTAMP WITH TIME ZONE,

  -- ========================================
  -- çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ¬ãƒãƒ¼ãƒˆç”»é¢ã§ä½¿ç”¨ï¼‰
  -- ========================================
  vibe_scores INTEGER[],  -- 48è¦ç´ ã®é…åˆ—ï¼ˆã‚°ãƒ©ãƒ•æç”»ç”¨ï¼‰
  average_vibe NUMERIC,  -- â˜…é‡è¦ï¼šãƒ¬ãƒãƒ¼ãƒˆç”»é¢ã§ä½¿ç”¨
  processed_count INTEGER,  -- å‡¦ç†æ¸ˆã¿ãƒ–ãƒ­ãƒƒã‚¯æ•°
  last_time_block TEXT,

  -- ========================================
  -- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  -- ========================================
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

  PRIMARY KEY (device_id, date)
);
```

---

### ãƒ†ãƒ¼ãƒ–ãƒ«7: `vibe_whisper`ï¼ˆæ—¢å­˜ã€å°†æ¥çš„ã«çµ±åˆæ¤œè¨ï¼‰

**ç¾çŠ¶ã®å½¹å‰²**ï¼štranscriptionä¿å­˜

**å•é¡Œç‚¹**ï¼š
- `timeblock_vibe`ã«ã‚‚transcriptionã‚«ãƒ©ãƒ ãŒã‚ã‚‹
- é‡è¤‡ã—ã¦ã„ã‚‹

**é¸æŠè‚¢**ï¼š

**A. vibe_whisperã‚’æ®‹ã™**
- transcriptionã¯`vibe_whisper`ã«ä¿å­˜
- `timeblock_vibe`ã‹ã‚‰ã¯å‚ç…§ã®ã¿ï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰

**B. vibe_whisperã‚’å»ƒæ­¢**
- transcriptionã¯`timeblock_vibe`ã«ç›´æ¥ä¿å­˜
- `vibe_whisper`ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å‰Šé™¤

**æ¨å¥¨ï¼šé¸æŠè‚¢B**
- ãƒ†ãƒ¼ãƒ–ãƒ«æ•°ã‚’æ¸›ã‚‰ã™
- ãƒ‡ãƒ¼ã‚¿ã®ä¸€å…ƒç®¡ç†
- ã‚·ãƒ³ãƒ—ãƒ«ãªè¨­è¨ˆ

**ãŸã ã—ã€ç§»è¡Œã¯æ…é‡ã«**ï¼š
- Phase 1-2: ä¸¡æ–¹ã«æ›¸ãè¾¼ã‚€
- Phase 3: `timeblock_vibe`ã®ã¿ä½¿ç”¨
- Phase 4: `vibe_whisper`å‰Šé™¤

---

### ãƒ†ãƒ¼ãƒ–ãƒ«8: `dashboard`ï¼ˆæ—§ãƒ†ãƒ¼ãƒ–ãƒ«ã€Phase 5ã§å‰Šé™¤ï¼‰

**å½¹å‰²**ï¼šãªã—ï¼ˆæ®µéšçš„ã«å»ƒæ­¢ï¼‰

```sql
-- Phase 5ã§å®Ÿè¡Œï¼ˆãƒ‡ãƒ¼ã‚¿ç§»è¡Œå®Œäº†å¾Œï¼‰
DROP TABLE dashboard CASCADE;
```

---

## ğŸ”„ æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### Lambda: audio-worker

```python
def lambda_handler(event, context):
    for record in event['Records']:
        message = json.loads(record['body'])
        file_path = message['file_path']
        device_id = message['device_id']
        date = message['date']
        time_slot = message['time_slot']

        # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆSKIPã‹ã©ã†ã‹ï¼‰
        status = get_transcription_status(file_path)

        if status == 'skipped':
            # SKIPã®å ´åˆï¼šã‚·ãƒ³ãƒ—ãƒ«ã«è¨˜éŒ²ã®ã¿
            supabase.table('timeblock_vibe').upsert({
                'device_id': device_id,
                'date': date,
                'time_block': time_slot,
                'status': 'skipped',
                'summary': 'å¤œé–“ä¼‘æ­¢æ™‚é–“ï¼ˆ23:00-05:59ï¼‰'
            })

            # ç´¯ç©åˆ†æã¯ãƒˆãƒªã‚¬ãƒ¼ï¼ˆSKIPã§ã‚‚å®Ÿè¡Œï¼‰
            trigger_dashboard_summary(device_id, date, time_slot)
            return

        # ========================================
        # Step 1: Vibe Transcriberï¼ˆæ–‡å­—èµ·ã“ã—ï¼‰
        # ========================================
        transcribe_response = requests.post(
            f"{API_BASE_URL}/vibe-analysis/transcriber/fetch-and-transcribe",
            json={"file_paths": [file_path]},
            timeout=900
        )

        if transcribe_response.status_code == 200:
            transcription = transcribe_response.json()['processed_files'][0]['transcription']

            # Step 1å®Œäº†ã‚’è¨˜éŒ²
            supabase.table('timeblock_vibe').upsert({
                'device_id': device_id,
                'date': date,
                'time_block': time_slot,
                'status': 'transcribed',
                'transcription': transcription,
                'transcribed_at': datetime.now().isoformat()
            })
        else:
            # å¤±æ•—ã‚’è¨˜éŒ²
            supabase.table('timeblock_vibe').upsert({
                'device_id': device_id,
                'date': date,
                'time_block': time_slot,
                'status': 'failed',
                'failure_reason': 'quota_exceeded',
                'error_message': 'Azure Speech API failed'
            })
            trigger_dashboard_summary(device_id, date, time_slot)
            return

        # ========================================
        # Step 1.5: Behavior & Emotionï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰
        # ========================================
        # ï¼ˆæ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ã€å¤‰æ›´ãªã—ï¼‰

        # ========================================
        # Step 2: Vibe Aggregatorï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼‰
        # ========================================
        aggregator_response = requests.get(
            f"{API_BASE_URL}/vibe-analysis/aggregator/generate-timeblock-prompt",
            params={
                "device_id": device_id,
                "date": date,
                "time_block": time_slot
            },
            timeout=900
        )

        if aggregator_response.status_code == 200:
            prompt = aggregator_response.json()['prompt']

            # Step 2å®Œäº†ã‚’è¨˜éŒ²
            supabase.table('timeblock_vibe').update({
                'status': 'prompt_ready',
                'prompt': prompt,
                'prompt_generated_at': datetime.now().isoformat()
            }).eq('device_id', device_id).eq('date', date).eq('time_block', time_slot).execute()

        # ========================================
        # Step 3: Vibe Scorerï¼ˆChatGPTåˆ†æï¼‰
        # ========================================
        scorer_response = requests.post(
            f"{API_BASE_URL}/vibe-analysis/scorer/analyze-timeblock",
            json={
                "prompt": prompt,
                "device_id": device_id,
                "date": date,
                "time_block": time_slot
            },
            timeout=900
        )

        if scorer_response.status_code == 200:
            result = scorer_response.json()['analysis_result']

            # Step 3å®Œäº†ã‚’è¨˜éŒ²
            supabase.table('timeblock_vibe').update({
                'status': 'completed',
                'vibe_score': result['vibe_score'],
                'summary': result['summary'],
                'burst_events': result.get('burst_events'),
                'analysis_result': result,
                'analyzed_at': datetime.now().isoformat()
            }).eq('device_id', device_id).eq('date', date).eq('time_block', time_slot).execute()

        # ========================================
        # ç´¯ç©åˆ†æãƒˆãƒªã‚¬ãƒ¼ï¼ˆå¿…ãšå®Ÿè¡Œï¼‰
        # ========================================
        trigger_dashboard_summary(device_id, date, time_slot)
```

---

### Lambda: summary-worker

```python
def lambda_handler(event, context):
    for record in event['Records']:
        message = json.loads(record['body'])
        device_id = message['device_id']
        date = message['date']

        # Dashboard Summary API ã‚’å‘¼ã³å‡ºã—
        response = requests.get(
            f"{API_BASE_URL}/vibe-analysis/aggregator/generate-dashboard-summary",
            params={"device_id": device_id, "date": date},
            timeout=180
        )

        if response.status_code == 200:
            prompt = response.json()['prompt']

            # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¿å­˜
            supabase.table('dashboard_summary').upsert({
                'device_id': device_id,
                'date': date,
                'status': 'prompt_ready',
                'prompt': prompt,
                'prompt_generated_at': datetime.now().isoformat()
            })

            # æ¬¡ã®ã‚­ãƒ¥ãƒ¼ã¸
            sqs.send_message(
                QueueUrl=ANALYSIS_QUEUE_URL,
                MessageBody=json.dumps({
                    'device_id': device_id,
                    'date': date,
                    'prompt': prompt
                })
            )
```

---

### Lambda: analysis-worker

```python
def lambda_handler(event, context):
    for record in event['Records']:
        message = json.loads(record['body'])
        device_id = message['device_id']
        date = message['date']

        # Dashboard Analysis API ã‚’å‘¼ã³å‡ºã—
        response = requests.post(
            f"{API_BASE_URL}/vibe-analysis/scorer/analyze-dashboard-summary",
            json={"device_id": device_id, "date": date},
            timeout=180
        )

        if response.status_code == 200:
            result = response.json()['analysis_result']

            # åˆ†æçµæœä¿å­˜
            supabase.table('dashboard_summary').update({
                'status': 'completed',
                'overall_summary': result['overall_summary'],
                'hourly_summaries': result.get('hourly_summaries'),
                'emotion_trends': result.get('emotion_trends'),
                'behavioral_patterns': result.get('behavioral_patterns'),
                'analyzed_at': datetime.now().isoformat()
            }).eq('device_id', device_id).eq('date', date).execute()

            # ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥
            send_push_notification(device_id, date)
```

---

## ğŸ“‹ ç§»è¡Œè¨ˆç”»

### åŸºæœ¬æ–¹é‡

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ãªã„ã®ã§å¤§èƒ†ã«å¤‰æ›´OK**
2. **æ®µéšçš„ã«ç§»è¡Œï¼ˆãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯èƒ½ã«ï¼‰**
3. **ä¸¦è¡Œé‹ç”¨æœŸé–“ã‚’è¨­ã‘ã‚‹ï¼ˆ1-2é€±é–“ï¼‰**

---

### Phase 1ï¼šæ–°ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆ1é€±é–“ï¼‰

**ç›®æ¨™**ï¼šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®æº–å‚™

**ã‚¿ã‚¹ã‚¯**ï¼š
- [ ] `timeblock_vibe` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] `dashboard_summary` ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚«ãƒ©ãƒ è¿½åŠ 
- [ ] ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°ä½œæˆ
- [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
- [ ] åˆ¶ç´„ã®å‹•ä½œç¢ºèª

**æˆåŠŸã®æ¡ä»¶**ï¼š
- [ ] æ–°ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã‚‹
- [ ] æ‰‹å‹•ã§ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æŒ¿å…¥ã§ãã‚‹
- [ ] CHECKåˆ¶ç´„ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ï¼ˆä¸æ­£ãªå€¤ã‚’æ‹’å¦ï¼‰
- [ ] ãƒˆãƒªã‚¬ãƒ¼ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ï¼ˆupdated_atè‡ªå‹•æ›´æ–°ï¼‰

---

### Phase 2ï¼šLambdaé–¢æ•°ã®ä¸¦è¡Œæ›¸ãè¾¼ã¿ï¼ˆ2é€±é–“ï¼‰

**ç›®æ¨™**ï¼šæ–°æ—§ä¸¡æ–¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€

**å¤‰æ›´å†…å®¹**ï¼š
- Lambdaé–¢æ•°ã‚’ä¿®æ­£
- æ–°ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ`timeblock_vibe`ï¼‰ã«æ›¸ãè¾¼ã¿
- æ—§ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ`dashboard`ï¼‰ã«ã‚‚æ›¸ãè¾¼ã¿ï¼ˆäº’æ›æ€§ç¶­æŒï¼‰

**æˆåŠŸã®æ¡ä»¶**ï¼š
- [ ] æ–°æ—§ä¸¡æ–¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ãŒæ›¸ãè¾¼ã¾ã‚Œã‚‹
- [ ] æ–°ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿å½¢å¼ãŒæ­£ã—ã„
- [ ] 1é€±é–“ã‚¨ãƒ©ãƒ¼ãªãå‹•ä½œã™ã‚‹

---

### Phase 3ï¼šiOSã‚¢ãƒ—ãƒªã®èª­ã¿å–ã‚Šå…ˆåˆ‡ã‚Šæ›¿ãˆï¼ˆ1é€±é–“ï¼‰

**ç›®æ¨™**ï¼šã‚¢ãƒ—ãƒªãŒæ–°ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚‹

**å¤‰æ›´å†…å®¹**ï¼š
- iOSå´ã®APIå¤‰æ›´
- `dashboard` â†’ `timeblock_vibe` ã«å¤‰æ›´

**æˆåŠŸã®æ¡ä»¶**ï¼š
- [ ] ã‚¢ãƒ—ãƒªã§æ­£ã—ããƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å•é¡ŒãŒãªã„
- [ ] 1é€±é–“ã‚¨ãƒ©ãƒ¼ãªãå‹•ä½œã™ã‚‹

---

### Phase 4ï¼šæ—§ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®æ›¸ãè¾¼ã¿åœæ­¢ï¼ˆ1é€±é–“ï¼‰

**ç›®æ¨™**ï¼šæ–°ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã¿ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€

**å¤‰æ›´å†…å®¹**ï¼š
- Lambdaé–¢æ•°ã‹ã‚‰æ—§ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®æ›¸ãè¾¼ã¿ã‚’å‰Šé™¤

**æˆåŠŸã®æ¡ä»¶**ï¼š
- [ ] ã‚¢ãƒ—ãƒªã§æ­£ã—ããƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆæ–°ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã¿ä½¿ç”¨ï¼‰
- [ ] 1é€±é–“å•é¡Œãªãå‹•ä½œã™ã‚‹

---

### Phase 5ï¼šæ—§ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤ï¼ˆ1é€±é–“ï¼‰

**ç›®æ¨™**ï¼šå®Œå…¨ç§»è¡Œ

**ã‚¿ã‚¹ã‚¯**ï¼š
- [ ] æ—§ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- [ ] `dashboard` ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤
- [ ] `vibe_whisper` ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤ï¼ˆæ¤œè¨ï¼‰
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

---

## âœ… ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ã‚¿ã‚¹ã‚¯

### Phase 1ï¼šæ–°ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆ1é€±é–“ï¼‰

#### ã‚¿ã‚¹ã‚¯1.1ï¼šSQLãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

**ãƒ•ã‚¡ã‚¤ãƒ«1**: `/server-configs/production/migrations/001_create_timeblock_vibe.sql`

```sql
-- ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°ä½œæˆ
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- timeblock_vibe ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
CREATE TABLE timeblock_vibe (
  -- ï¼ˆä¸Šè¨˜ã®è©³ç´°ãªSQLå‚ç…§ï¼‰
  ...
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
CREATE INDEX idx_timeblock_vibe_device_date
  ON timeblock_vibe(device_id, date);

CREATE INDEX idx_timeblock_vibe_status
  ON timeblock_vibe(status)
  WHERE status IN ('pending', 'transcribed', 'prompt_ready');

-- ãƒˆãƒªã‚¬ãƒ¼ä½œæˆ
CREATE TRIGGER update_timeblock_vibe_updated_at
  BEFORE UPDATE ON timeblock_vibe
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();
```

**ãƒ•ã‚¡ã‚¤ãƒ«2**: `/server-configs/production/migrations/002_alter_dashboard_summary.sql`

```sql
-- dashboard_summary ãƒ†ãƒ¼ãƒ–ãƒ«å¤‰æ›´
ALTER TABLE dashboard_summary
  ADD COLUMN IF NOT EXISTS status TEXT DEFAULT 'pending'
    CHECK (status IN ('pending', 'prompt_ready', 'analyzing', 'completed', 'failed')),
  ADD COLUMN IF NOT EXISTS prompt_generated_at TIMESTAMP WITH TIME ZONE,
  ADD COLUMN IF NOT EXISTS analyzed_at TIMESTAMP WITH TIME ZONE;

-- ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
COMMENT ON COLUMN dashboard_summary.status IS ...;
COMMENT ON COLUMN dashboard_summary.prompt IS ...;
```

#### ã‚¿ã‚¹ã‚¯1.2ï¼šãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

- [ ] Supabase SQL Editorã§å®Ÿè¡Œ
- [ ] ã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ç¢ºèª

#### ã‚¿ã‚¹ã‚¯1.3ï¼šå‹•ä½œç¢ºèª

```sql
-- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŒ¿å…¥
INSERT INTO timeblock_vibe (
  device_id, date, time_block, status, transcription, prompt, vibe_score, summary
) VALUES (
  '9f7d6e27-98c3-4c19-bdfb-f7fda58b9a93',
  '2025-11-09',
  '09-00',
  'completed',
  'ãƒ†ã‚¹ãƒˆæ–‡å­—èµ·ã“ã—',
  'ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ',
  75,
  'ãƒ†ã‚¹ãƒˆã‚µãƒãƒªãƒ¼'
);

-- ç¢ºèª
SELECT * FROM timeblock_vibe;

-- CHECKåˆ¶ç´„ã®ãƒ†ã‚¹ãƒˆï¼ˆã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã¯ãšï¼‰
INSERT INTO timeblock_vibe (
  device_id, date, time_block, status, vibe_score
) VALUES (
  '9f7d6e27-98c3-4c19-bdfb-f7fda58b9a93',
  '2025-11-09',
  '10-00',
  'completed',
  75
  -- âŒ summaryãŒãªã„ã®ã§ã‚¨ãƒ©ãƒ¼
);
```

---

### Phase 2ï¼šLambdaé–¢æ•°ä¿®æ­£ï¼ˆ2é€±é–“ï¼‰

ï¼ˆä¸Šè¨˜ã®ã€Œæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã€å‚ç…§ï¼‰

---

## ğŸ“ æœªè§£æ±ºã®è³ªå•ã¨ä»Šå¾Œã®æ¤œè¨äº‹é …

### è³ªå•1ï¼š`vibe_whisper`ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ‰±ã„

**ç¾çŠ¶**ï¼š
- `vibe_whisper`ã«transcriptionä¿å­˜
- `timeblock_vibe`ã«ã‚‚transcriptionä¿å­˜
- **é‡è¤‡ã—ã¦ã„ã‚‹**

**é¸æŠè‚¢**ï¼š
- A. ä¸¡æ–¹æ®‹ã™ï¼ˆå‚ç…§ç”¨ã«åˆ†ã‘ã‚‹ï¼‰
- B. `vibe_whisper`å‰Šé™¤ï¼ˆ`timeblock_vibe`ã«çµ±åˆï¼‰â† æ¨å¥¨

**æ±ºå®š**ï¼šPhase 1ã®å‹•ä½œç¢ºèªå¾Œã«åˆ¤æ–­

---

### è³ªå•2ï¼šãƒ¬ãƒãƒ¼ãƒˆç”»é¢ã®å®Ÿè£…æ–¹æ³•

**ç¾çŠ¶ã®ç†è§£**ï¼š
- é€±æ¬¡: 7æ—¥åˆ†ã®`dashboard_summary.average_vibe`ã‚’è¡¨ç¤º
- æœˆæ¬¡: 30æ—¥åˆ†ã®`dashboard_summary.average_vibe`ã‚’è¡¨ç¤º
- å¹´æ¬¡: 12ãƒ¶æœˆåˆ†ã‚’ã‚¢ãƒ—ãƒªå´ã§å¹³å‡

**é¸æŠè‚¢**ï¼š
- A. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§é›†è¨ˆï¼ˆç¾åœ¨ã®æ–¹é‡ï¼‰
- B. ã‚µãƒ¼ãƒãƒ¼å´APIã§é›†è¨ˆ
- C. ãƒ“ãƒ¥ãƒ¼ã§æœ€é©åŒ–

**æ±ºå®š**ï¼šPhase 3ä»¥é™ã§æ¤œè¨

---

### è³ªå•3ï¼šå¤ã„ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤

**è€ƒæ…®äº‹é …**ï¼š
- ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã¯ä½•æ—¥åˆ†ä¿æŒï¼Ÿ
- ç´¯ç©ãƒ‡ãƒ¼ã‚¿ã¯ä½•ãƒ¶æœˆåˆ†ä¿æŒï¼Ÿ
- TTLï¼ˆè‡ªå‹•å‰Šé™¤ï¼‰ã¯å¿…è¦ï¼Ÿ

**æ±ºå®š**ï¼šPhase 5ä»¥é™ã§æ¤œè¨

---

## ğŸ¯ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

**Phase 1ã‚’é–‹å§‹ã—ã¾ã™**

1. SQLãƒ•ã‚¡ã‚¤ãƒ«3ã¤ã‚’ä½œæˆ
2. Supabaseã§å®Ÿè¡Œ
3. æ‰‹å‹•ã§ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æŒ¿å…¥ã—ã¦å‹•ä½œç¢ºèª

æº–å‚™ãŒã§ããŸã‚‰é–‹å§‹ã—ã¦ãã ã•ã„ã€‚

---

**æœ€çµ‚æ›´æ–°**: 2025-11-09 00:45
**æ¬¡å›ã®ä½œæ¥­é–‹å§‹æ™‚ã®ç¢ºèªäº‹é …**:
- [ ] ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æœ€åˆã‹ã‚‰æœ€å¾Œã¾ã§èª­ã‚€
- [ ] ã€Œå‰å›ã®è­°è«–ã‚µãƒãƒªãƒ¼ã€ã‚’ç¢ºèª
- [ ] ã€Œç”»é¢æ§‹æˆã¨ãƒ‡ãƒ¼ã‚¿ã®ä½¿ã‚ã‚Œæ–¹ã€ã‚’ç¢ºèª
- [ ] ã€Œå‡¦ç†ãƒ•ãƒ­ãƒ¼ã®æ­£ã—ã„ç†è§£ã€ã‚’ç¢ºèª
- [ ] Phase 1ã®ã‚¿ã‚¹ã‚¯ã‹ã‚‰é–‹å§‹

**ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆç¶™ç¶šã®ãŸã‚ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰**ï¼š
- å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«ãƒ†ãƒ¼ãƒ–ãƒ«åˆ†é›¢
- ASRã¯3ã‚¹ãƒ†ãƒƒãƒ—ã€SED/SERã¯2ã‚¹ãƒ†ãƒƒãƒ—
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ä¿å­˜å¿…é ˆï¼ˆæ¤œè¨¼ãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
- æ°—åˆ†ãƒ»è¡Œå‹•ãƒ»æ„Ÿæƒ…ã¯åˆ¥ã€…ã®æŸ±
- ãƒ¬ãƒãƒ¼ãƒˆã¯ç´¯ç©ãƒ‡ãƒ¼ã‚¿ã®ã¿ä½¿ç”¨
- DynamoDBã¯ä¸è¦ã€Supabaseã§ååˆ†
