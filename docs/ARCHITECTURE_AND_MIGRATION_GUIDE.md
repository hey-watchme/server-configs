# ðŸ—ï¸ WatchMe ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»ç§»è¡Œã‚¬ã‚¤ãƒ‰

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: å¿ƒç†ãƒ»æ„Ÿæƒ…ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 
**ä½œæˆæ—¥**: 2025-11-11
**æœ€çµ‚æ›´æ–°**: 2025-11-12 åˆå¾Œ
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… Phase 3å®Œäº†ï¼ˆ80%ï¼‰ / ðŸš§ Phase 4 é€²è¡Œä¸­ï¼ˆæ®‹ã‚Š20%ï¼‰

---

## ðŸ“– ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
2. [3ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆæ€æƒ³](#3ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆæ€æƒ³)
3. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å…¨ä½“åƒ](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å…¨ä½“åƒ)
4. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒž](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒž)
5. [é€²æ—çŠ¶æ³](#é€²æ—çŠ¶æ³)
6. [æ¬¡ã®ã‚¿ã‚¹ã‚¯](#æ¬¡ã®ã‚¿ã‚¹ã‚¯)
7. [å¤‰æ›´å±¥æ­´](#å¤‰æ›´å±¥æ­´)

---

## ðŸŽ¯ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### è¨­è¨ˆåŽŸå‰‡

**UTCçµ±ä¸€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: ã™ã¹ã¦ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’UTCã§ä¿å­˜ã—ã€è¡¨ç¤ºæ™‚ã«å„ãƒ‡ãƒã‚¤ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã«å¤‰æ›

**3ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆ**: ç‰¹å¾´æŠ½å‡º â†’ çµ±åˆ â†’ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚° ã®æ˜Žç¢ºãªè²¬ä»»åˆ†é›¢

**ãƒžã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: å„APIã¯ç‹¬ç«‹ã—ã¦å‹•ä½œã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é€šã˜ã¦é€£æº

---

## ðŸ—ï¸ 3ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆæ€æƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: Feature Extractionï¼ˆç‰¹å¾´æŠ½å‡ºå±¤ï¼‰                      â”‚
â”‚                                                               â”‚
â”‚ å½¹å‰²: éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º                             â”‚
â”‚ æŠ€è¡“: ASR (éŸ³å£°èªè­˜), SED (éŸ³éŸ¿ã‚¤ãƒ™ãƒ³ãƒˆ), SER (æ„Ÿæƒ…èªè­˜)        â”‚
â”‚                                                               â”‚
â”‚ /api/vibe-analysis/transcriber                               â”‚
â”‚   â”œâ”€ å…¥åŠ›: S3éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«                                      â”‚
â”‚   â””â”€ å‡ºåŠ›: spot_features.vibe_transcriber_result (TEXT)      â”‚
â”‚                                                               â”‚
â”‚ /api/behavior-analysis/feature-extractor                     â”‚
â”‚   â”œâ”€ å…¥åŠ›: S3éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«                                      â”‚
â”‚   â””â”€ å‡ºåŠ›: spot_features.behavior_extractor_result (JSONB)   â”‚
â”‚                                                               â”‚
â”‚ /api/emotion-analysis/feature-extractor                      â”‚
â”‚   â”œâ”€ å…¥åŠ›: S3éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«                                      â”‚
â”‚   â””â”€ å‡ºåŠ›: spot_features.emotion_extractor_result (JSONB)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: Aggregationï¼ˆçµ±åˆå±¤ï¼‰                                â”‚
â”‚                                                               â”‚
â”‚ å½¹å‰²: 3ã¤ã®ç‰¹å¾´ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆã—ã€LLMç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ             â”‚
â”‚ æŠ€è¡“: ãƒ‡ãƒ¼ã‚¿çµ±åˆã€æ™‚é–“ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚° â”‚
â”‚                                                               â”‚
â”‚ /api/aggregator                                              â”‚
â”‚   â”œâ”€ å…¥åŠ›: spot_features (ASR + SED + SER)                   â”‚
â”‚   â”œâ”€ å‡¦ç†: ãƒ‡ãƒã‚¤ã‚¹timezoneå–å¾— â†’ UTCâ†’ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ›             â”‚
â”‚   â”‚        subject_infoçµ±åˆ â†’ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ                   â”‚
â”‚   â””â”€ å‡ºåŠ›: spot_aggregators.aggregated_prompt (TEXT)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: Profilerï¼ˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°å±¤ï¼‰ðŸŽ¯ ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­å¿ƒ  â”‚
â”‚                                                               â”‚
â”‚ å½¹å‰²: LLMåˆ†æžã«ã‚ˆã‚‹å¿ƒç†ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ï¼ˆè¤‡æ•°æ™‚é–“è»¸ï¼‰             â”‚
â”‚ æŠ€è¡“: ChatGPT/Groq, ç´¯ç©åˆ†æž, é•·æœŸãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æž                  â”‚
â”‚                                                               â”‚
â”‚ /api/profiler ðŸš§ æ–°è¦ä½œæˆäºˆå®š                                 â”‚
â”‚                                                               â”‚
â”‚   â”œâ”€ POST /spot-profiler                                     â”‚
â”‚   â”‚  â”œâ”€ å…¥åŠ›: spot_aggregators.aggregated_prompt             â”‚
â”‚   â”‚  â”œâ”€ å‡¦ç†: LLMåˆ†æžï¼ˆã‚¹ãƒãƒƒãƒˆéŒ²éŸ³ã®å¿ƒç†åˆ†æžï¼‰                â”‚
â”‚   â”‚  â”œâ”€ å‡ºåŠ›: spot_results                                    â”‚
â”‚   â”‚  â””â”€ èª¬æ˜Ž: 1å›žã®éŒ²éŸ³ï¼ˆä»»æ„ã®é•·ã•ï¼š3ç§’ã€œ10åˆ†ï¼‰ã®å¿ƒç†åˆ†æž       â”‚
â”‚   â”‚                                                           â”‚
â”‚   â”œâ”€ POST /daily-profiler                                    â”‚
â”‚   â”‚  â”œâ”€ å…¥åŠ›: spot_resultsï¼ˆ1æ—¥åˆ†ï¼‰                           â”‚
â”‚   â”‚  â”œâ”€ å‡¦ç†: LLMç´¯ç©åˆ†æžï¼ˆ1æ—¥ã®å¿ƒç†ãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰                 â”‚
â”‚   â”‚  â”œâ”€ å‡ºåŠ›: summary_daily                                   â”‚
â”‚   â”‚  â””â”€ èª¬æ˜Ž: 1æ—¥åˆ†ã®spotéŒ²éŸ³ã‚’çµ±åˆã—ã€æ—¥æ¬¡ã®å¿ƒç†çŠ¶æ…‹ã‚’åˆ†æž     â”‚
â”‚   â”‚                                                           â”‚
â”‚   â”œâ”€ POST /weekly-profiler ðŸ†•                                â”‚
â”‚   â”‚  â”œâ”€ å…¥åŠ›: summary_dailyï¼ˆ7æ—¥åˆ†ï¼‰                          â”‚
â”‚   â”‚  â”œâ”€ å‡¦ç†: LLMé€±æ¬¡åˆ†æžï¼ˆ1é€±é–“ã®å¿ƒç†å¤‰å‹•ï¼‰                   â”‚
â”‚   â”‚  â”œâ”€ å‡ºåŠ›: summary_weekly                                  â”‚
â”‚   â”‚  â””â”€ èª¬æ˜Ž: é€±å˜ä½ã®å¿ƒç†ãƒˆãƒ¬ãƒ³ãƒ‰ã€é€±å†…ã®å¤‰å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æž       â”‚
â”‚   â”‚                                                           â”‚
â”‚   â””â”€ POST /monthly-profiler ðŸ†•                               â”‚
â”‚      â”œâ”€ å…¥åŠ›: summary_dailyï¼ˆ30æ—¥åˆ†ï¼‰                         â”‚
â”‚      â”œâ”€ å‡¦ç†: LLMæœˆæ¬¡åˆ†æžï¼ˆ1ãƒ¶æœˆã®é•·æœŸãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰               â”‚
â”‚      â”œâ”€ å‡ºåŠ›: summary_monthly                                 â”‚
â”‚      â””â”€ èª¬æ˜Ž: æœˆå˜ä½ã®å¿ƒç†å¤‰åŒ–ã€ç”Ÿæ´»ãƒªã‚ºãƒ ã€é•·æœŸçš„å‚¾å‘åˆ†æž       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å…¨ä½“åƒ

### Phase 1: éŒ²éŸ³ â†’ S3ä¿å­˜

```
iOS/Observer Device
  â†“ éŸ³å£°éŒ²éŸ³ï¼ˆä»»æ„ã®é•·ã•ï¼‰
S3 Bucket (watchme-vault)
  â†“ S3ã‚¤ãƒ™ãƒ³ãƒˆ
Lambda (audio-processor)
  â†“ SQSã‚­ãƒ¥ãƒ¼
Lambda (audio-worker)
  â†“ HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ
Vault API
  â†“ INSERT
audio_files (recorded_at: UTC)
```

---

### Phase 2: ç‰¹å¾´æŠ½å‡ºï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰

```
Lambda (audio-worker) â†’ 3ã¤ã®APIã‚’ä¸¦åˆ—å®Ÿè¡Œ

â”Œâ”€ Vibe Transcriber (ASR)
â”‚    â””â”€ å‡ºåŠ›: spot_features.vibe_transcriber_result
â”‚
â”œâ”€ Behavior Features (SED)
â”‚    â””â”€ å‡ºåŠ›: spot_features.behavior_extractor_result
â”‚
â””â”€ Emotion Features (SER)
     â””â”€ å‡ºåŠ›: spot_features.emotion_extractor_result

â±ï¸ å‡¦ç†æ™‚é–“: ç´„5-10ç§’ï¼ˆä¸¦åˆ—å‡¦ç†ï¼‰
```

---

### Phase 3: çµ±åˆãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ

```
Aggregator API (/api/aggregator)

1. spot_features ã‹ã‚‰ ASR + SED + SER ãƒ‡ãƒ¼ã‚¿å–å¾—
2. devices.timezone å–å¾—
3. UTC â†’ ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã«å¤‰æ›ï¼ˆpytzä½¿ç”¨ï¼‰
4. subject_infoï¼ˆå¹´é½¢ãƒ»æ€§åˆ¥ï¼‰å–å¾—
5. æ™‚é–“ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆï¼ˆå­£ç¯€ã€æ›œæ—¥ã€æ™‚é–“å¸¯ã€ç¥æ—¥ï¼‰
6. çµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼ˆ3ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆï¼‰
7. spot_aggregators ã«ä¿å­˜

â±ï¸ å‡¦ç†æ™‚é–“: ç´„1-2ç§’
```

---

### Phase 4: ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ï¼ˆLLMåˆ†æžï¼‰ðŸŽ¯

```
Profiler API (/api/profiler) ðŸš§ æ–°è¦ä½œæˆäºˆå®š

â”Œâ”€ Spot Profiler
â”‚  1. spot_aggregators.aggregated_prompt å–å¾—
â”‚  2. ChatGPT/Groq LLMå®Ÿè¡Œ
â”‚  3. spot_results ã«ä¿å­˜
â”‚  â±ï¸ å‡¦ç†æ™‚é–“: ç´„3-5ç§’
â”‚
â”œâ”€ Daily Profiler
â”‚  1. spot_resultsï¼ˆ1æ—¥åˆ†ï¼‰å–å¾—
â”‚  2. ç´¯ç©åˆ†æžãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
â”‚  3. ChatGPT/Groq LLMå®Ÿè¡Œ
â”‚  4. summary_daily ã«ä¿å­˜
â”‚  â±ï¸ å‡¦ç†æ™‚é–“: ç´„5-10ç§’
â”‚
â”œâ”€ Weekly Profiler ðŸ†•
â”‚  1. summary_dailyï¼ˆ7æ—¥åˆ†ï¼‰å–å¾—
â”‚  2. é€±æ¬¡åˆ†æžãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
â”‚  3. ChatGPT/Groq LLMå®Ÿè¡Œ
â”‚  4. summary_weekly ã«ä¿å­˜
â”‚  â±ï¸ å‡¦ç†æ™‚é–“: ç´„10-15ç§’
â”‚
â””â”€ Monthly Profiler ðŸ†•
   1. summary_dailyï¼ˆ30æ—¥åˆ†ï¼‰å–å¾—
   2. æœˆæ¬¡åˆ†æžãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
   3. ChatGPT/Groq LLMå®Ÿè¡Œ
   4. summary_monthly ã«ä¿å­˜
   â±ï¸ å‡¦ç†æ™‚é–“: ç´„15-20ç§’
```

---

### Phase 5: è¡¨ç¤ºï¼ˆiOS/Webï¼‰

```
iOS/Web Dashboard

1. å„resultsãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
   - spot_results: ã‚¹ãƒãƒƒãƒˆåˆ†æžçµæžœ
   - summary_daily: æ—¥æ¬¡åˆ†æžçµæžœ
   - summary_weekly: é€±æ¬¡åˆ†æžçµæžœ
   - summary_monthly: æœˆæ¬¡åˆ†æžçµæžœ

2. devices.timezone å–å¾—

3. UTC â†’ ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã«å¤‰æ›

4. UIè¡¨ç¤º
   - ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤º
   - ã‚¹ã‚³ã‚¢ã‚°ãƒ©ãƒ•
   - å¿ƒç†åˆ†æžã‚µãƒžãƒªãƒ¼
   - ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æž
```

---

## ðŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒž

### 1. audio_files - éŒ²éŸ³ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±

```sql
CREATE TABLE audio_files (
  device_id TEXT NOT NULL,
  recorded_at TIMESTAMPTZ NOT NULL,  -- UTC
  file_path TEXT NOT NULL,
  vibe_transcriber_status TEXT DEFAULT 'pending',
  behavior_extractor_status TEXT DEFAULT 'pending',
  emotion_extractor_status TEXT DEFAULT 'pending',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  PRIMARY KEY (device_id, recorded_at)
);
```

**å½¹å‰²**: S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†

---

### 2. spot_features - ç‰¹å¾´æŠ½å‡ºçµæžœ

```sql
CREATE TABLE spot_features (
  device_id TEXT NOT NULL,
  recorded_at TIMESTAMPTZ NOT NULL,  -- UTC

  -- 3ã¤ã®ç‰¹å¾´æŠ½å‡ºçµæžœ
  vibe_transcriber_result TEXT,          -- ASR: æ–‡å­—èµ·ã“ã—ãƒ†ã‚­ã‚¹ãƒˆ
  behavior_extractor_result JSONB,       -- SED: 527ç¨®é¡žã®éŸ³éŸ¿ã‚¤ãƒ™ãƒ³ãƒˆ
  emotion_extractor_result JSONB,        -- SER: 8æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ + OpenSMILEç‰¹å¾´é‡

  -- å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  vibe_transcriber_status TEXT,
  vibe_transcriber_processed_at TIMESTAMPTZ,
  behavior_extractor_status TEXT,
  behavior_extractor_processed_at TIMESTAMPTZ,
  emotion_extractor_status TEXT,
  emotion_extractor_processed_at TIMESTAMPTZ,

  created_at TIMESTAMPTZ DEFAULT NOW(),
  PRIMARY KEY (device_id, recorded_at)
);
```

**å½¹å‰²**: Layer 1ï¼ˆç‰¹å¾´æŠ½å‡ºå±¤ï¼‰ã®å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ä¿å­˜

**é‡è¦**: RLSï¼ˆRow Level Securityï¼‰ã¯ç„¡åŠ¹åŒ–ï¼ˆå†…éƒ¨APIå°‚ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

---

### 3. spot_aggregators - çµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

```sql
CREATE TABLE spot_aggregators (
  device_id TEXT NOT NULL,
  recorded_at TIMESTAMPTZ NOT NULL,  -- UTC
  prompt TEXT NOT NULL,               -- LLMåˆ†æžç”¨çµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆæ—§: aggregated_promptï¼‰
  context_data JSONB,                 -- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆtimezone, subject_infoç­‰ï¼‰
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),  -- æ—§: aggregated_at
  PRIMARY KEY (device_id, recorded_at)
);
```

**å½¹å‰²**: Layer 2ï¼ˆçµ±åˆå±¤ï¼‰ã®å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ä¿å­˜

**é‡è¦**: RLSï¼ˆRow Level Securityï¼‰ã¯ç„¡åŠ¹åŒ–ï¼ˆå†…éƒ¨APIå°‚ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

**prompt ã®å†…å®¹**ï¼ˆç´„4700æ–‡å­—ï¼‰:
- ASRï¼ˆæ–‡å­—èµ·ã“ã—ï¼‰
- SEDï¼ˆéŸ³éŸ¿ã‚¤ãƒ™ãƒ³ãƒˆï¼‰çµ±è¨ˆ
- SERï¼ˆæ„Ÿæƒ…ï¼‰ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
- æ™‚é–“ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆå­£ç¯€ã€æ›œæ—¥ã€æ™‚é–“å¸¯ã€ç¥æ—¥ï¼‰
- subject_infoï¼ˆå¹´é½¢ã€æ€§åˆ¥ã€ãƒ¡ãƒ¢ï¼‰
- LLMåˆ†æžç”¨ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

---

### 4. spot_results - ã‚¹ãƒãƒƒãƒˆåˆ†æžçµæžœ

```sql
CREATE TABLE spot_results (
  device_id TEXT NOT NULL,
  recorded_at TIMESTAMPTZ NOT NULL,  -- UTC

  -- åŸºæœ¬ã‚¹ã‚³ã‚¢
  vibe_score INTEGER CHECK (vibe_score >= -100 AND vibe_score <= 100),
  vibe_summary TEXT,                  -- 2-3æ–‡ã®è¦ç´„
  vibe_behavior TEXT,                 -- è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³

  -- è©³ç´°åˆ†æž
  psychological_analysis JSONB,       -- å¿ƒç†åˆ†æžè©³ç´°
  behavioral_analysis JSONB,          -- è¡Œå‹•åˆ†æžè©³ç´°
  acoustic_metrics JSONB,             -- éŸ³éŸ¿ãƒ¡ãƒˆãƒªã‚¯ã‚¹
  key_observations JSONB,             -- é‡è¦ãªè¦³å¯Ÿäº‹é …

  -- ãƒ¡ã‚¿æƒ…å ±
  vibe_scorer_result JSONB,           -- LLMã®å®Œå…¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹
  vibe_analyzed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),

  PRIMARY KEY (device_id, recorded_at)
);
```

**å½¹å‰²**: Layer 3ï¼ˆProfiler - Spotï¼‰ã®å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ä¿å­˜

---

### 5. summary_daily - æ—¥æ¬¡åˆ†æžçµæžœï¼ˆæ—¢å­˜ï¼‰

```sql
CREATE TABLE summary_daily (
  device_id TEXT NOT NULL,
  date DATE NOT NULL,

  -- ç´¯ç©åˆ†æžçµæžœ
  cumulative_evaluation TEXT,         -- 1æ—¥ã®ç·åˆè©•ä¾¡
  mood_trajectory TEXT,               -- æ°—åˆ†ã®å¤‰å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³
  current_state_score INTEGER,        -- ç¾åœ¨ã®çŠ¶æ…‹ã‚¹ã‚³ã‚¢

  -- çµ±è¨ˆæƒ…å ±
  spot_count INTEGER,                 -- ã‚¹ãƒãƒƒãƒˆéŒ²éŸ³ã®å›žæ•°
  average_vibe_score REAL,            -- å¹³å‡vibeã‚¹ã‚³ã‚¢

  -- è©³ç´°åˆ†æž
  daily_analysis_result JSONB,        -- LLMã®å®Œå…¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹
  analyzed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),

  PRIMARY KEY (device_id, date)
);
```

**å½¹å‰²**: Layer 3ï¼ˆProfiler - Dailyï¼‰ã®å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ä¿å­˜

---

### 6. summary_weekly - é€±æ¬¡åˆ†æžçµæžœ ðŸ†•

```sql
CREATE TABLE summary_weekly (
  device_id TEXT NOT NULL,
  week_start_date DATE NOT NULL,      -- é€±ã®é–‹å§‹æ—¥ï¼ˆæœˆæ›œæ—¥ï¼‰
  week_end_date DATE NOT NULL,        -- é€±ã®çµ‚äº†æ—¥ï¼ˆæ—¥æ›œæ—¥ï¼‰

  -- é€±æ¬¡åˆ†æžçµæžœ
  weekly_evaluation TEXT,             -- 1é€±é–“ã®ç·åˆè©•ä¾¡
  mood_trend TEXT,                    -- é€±å†…ã®æ°—åˆ†ãƒˆãƒ¬ãƒ³ãƒ‰
  average_weekly_score INTEGER,       -- é€±å¹³å‡ã‚¹ã‚³ã‚¢

  -- çµ±è¨ˆæƒ…å ±
  active_days INTEGER,                -- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªæ—¥æ•°
  total_spot_count INTEGER,           -- é€±å…¨ä½“ã®ã‚¹ãƒãƒƒãƒˆéŒ²éŸ³æ•°

  -- è©³ç´°åˆ†æž
  weekly_analysis_result JSONB,       -- LLMã®å®Œå…¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹
  analyzed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),

  PRIMARY KEY (device_id, week_start_date)
);
```

**å½¹å‰²**: Layer 3ï¼ˆProfiler - Weeklyï¼‰ã®å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ä¿å­˜ ðŸ†•

---

### 7. summary_monthly - æœˆæ¬¡åˆ†æžçµæžœ ðŸ†•

```sql
CREATE TABLE summary_monthly (
  device_id TEXT NOT NULL,
  year INTEGER NOT NULL,
  month INTEGER NOT NULL,

  -- æœˆæ¬¡åˆ†æžçµæžœ
  monthly_evaluation TEXT,            -- 1ãƒ¶æœˆã®ç·åˆè©•ä¾¡
  long_term_trend TEXT,               -- é•·æœŸãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æž
  average_monthly_score INTEGER,      -- æœˆå¹³å‡ã‚¹ã‚³ã‚¢

  -- çµ±è¨ˆæƒ…å ±
  active_days INTEGER,                -- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªæ—¥æ•°
  total_spot_count INTEGER,           -- æœˆå…¨ä½“ã®ã‚¹ãƒãƒƒãƒˆéŒ²éŸ³æ•°

  -- è©³ç´°åˆ†æž
  monthly_analysis_result JSONB,      -- LLMã®å®Œå…¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹
  analyzed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),

  PRIMARY KEY (device_id, year, month)
);
```

**å½¹å‰²**: Layer 3ï¼ˆProfiler - Monthlyï¼‰ã®å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ä¿å­˜ ðŸ†•

---

### 8. devicesï¼ˆæ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

```sql
-- timezone ã‚«ãƒ©ãƒ ã‚’ä½¿ç”¨
SELECT device_id, timezone FROM devices;
-- ä¾‹: 9f7d6e27-..., Asia/Tokyo
```

**å½¹å‰²**: ãƒ‡ãƒã‚¤ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æƒ…å ±ç®¡ç†ï¼ˆUTCâ†’ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“å¤‰æ›ã«ä½¿ç”¨ï¼‰

---

## ðŸ“‹ é€²æ—çŠ¶æ³ï¼ˆ2025-11-12 æœ€çµ‚æ›´æ–°ï¼‰

### âœ… Phase 1å®Œäº†: éŒ²éŸ³ï¼ˆiOS â†’ S3 â†’ Vault APIï¼‰

- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿®æ­£å®Œäº†
- âœ… iOS ã‚¢ãƒ—ãƒª: `recorded_at` ã‚’UTCã§é€ä¿¡
- âœ… Vault API: `local_datetime` å‰Šé™¤ã€S3ãƒ‘ã‚¹ç§’å˜ä½ç²¾åº¦åŒ–
- âœ… æœ¬ç•ªå‹•ä½œç¢ºèªæ¸ˆã¿ ðŸŽ‰

---

### âœ… Phase 2å®Œäº†: ç‰¹å¾´æŠ½å‡ºï¼ˆASR + SED + SERï¼‰

- âœ… Vibe Transcriberï¼ˆASRï¼‰: `spot_features` ç§»è¡Œå®Œäº†
- âœ… Behavior Featuresï¼ˆSEDï¼‰: `spot_features` ç§»è¡Œå®Œäº†
- âœ… Emotion Feature Extractor v2ï¼ˆSERï¼‰: `spot_features` ç§»è¡Œå®Œäº†
- âœ… æœ¬ç•ªå‹•ä½œç¢ºèªæ¸ˆã¿ ðŸŽ‰

---

### âœ… Phase 3å®Œäº†: çµ±åˆãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼ˆ2025-11-12 å®Œäº†ï¼‰

- âœ… Aggregator API: ASR+SED+SERçµ±åˆã€timezoneå¯¾å¿œã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆå®Œäº†
- âœ… `spot_aggregators` ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜
  - `prompt` ã‚«ãƒ©ãƒ ï¼ˆæ—§ aggregated_promptï¼‰
  - `context_data` ã‚«ãƒ©ãƒ ï¼ˆJSONBï¼‰
  - `created_at` ã‚«ãƒ©ãƒ ï¼ˆæ—§ aggregated_atï¼‰
  - RLSç„¡åŠ¹åŒ–å®Œäº†
- âœ… UTCçµ±ä¸€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¯¾å¿œå®Œäº†
  - `local_date`, `local_time` ã‚«ãƒ©ãƒ å‰Šé™¤
  - UTCâ†’ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“å¤‰æ›ã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆæ™‚ã®ã¿å®Ÿæ–½
- âœ… Nginxè¨­å®šè¿½åŠ å®Œäº†
  - `/aggregator/` â†’ `http://localhost:8050/aggregator/`
- âœ… æœ¬ç•ªå‹•ä½œç¢ºèªæ¸ˆã¿ ðŸŽ‰
  - URL: https://api.hey-watch.me/aggregator/spot
  - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé•·: 4700æ–‡å­—ç¨‹åº¦
  - å‡¦ç†æ™‚é–“: 1-2ç§’

---

### ðŸš§ Phase 4é€²è¡Œä¸­: Profiler APIæ–°è¦ä½œæˆï¼ˆæ®‹ã‚Š20%ï¼‰

#### ç¾çŠ¶ã®èª²é¡Œ

- âŒ Profiler API (`/api/profiler`) ãŒæœªä½œæˆ
- âš ï¸ æ—¢å­˜Scorer API (`/api/vibe-analysis/scorer`) ãŒæ—§ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã¾ã¾
  - ä¿å­˜å…ˆ: `audio_scorer` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ—§ï¼‰
  - å…¥åŠ›å…ƒ: `audio_aggregator.vibe_aggregator_result`ï¼ˆæ—§ï¼‰

#### å¿…è¦ãªä½œæ¥­

**1. Profiler APIæ–°è¦ä½œæˆ**ï¼ˆæœ€å„ªå…ˆï¼‰

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: `/Users/kaya.matsumoto/projects/watchme/api/profiler`

```
/api/profiler/
â”œâ”€â”€ main.py
â”œâ”€â”€ endpoints/
â”‚   â”œâ”€â”€ spot_profiler.py       # æ—¢å­˜Scorerã‹ã‚‰ç§»æ¤
â”‚   â”œâ”€â”€ daily_profiler.py      # æ—¢å­˜Scorerã‹ã‚‰ç§»æ¤
â”‚   â”œâ”€â”€ weekly_profiler.py     # æ–°è¦å®Ÿè£…
â”‚   â””â”€â”€ monthly_profiler.py    # æ–°è¦å®Ÿè£…
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ llm_client.py          # æ—¢å­˜Scorerã‹ã‚‰ç§»æ¤
â”‚   â””â”€â”€ supabase_client.py
â”œâ”€â”€ docker-compose.prod.yml
â”œâ”€â”€ Dockerfile.prod
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

**æŽ¨å®šä½œæ¥­æ™‚é–“**: 3-4æ™‚é–“

---

**2. 4ã¤ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…**

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | å…¥åŠ› | å‡ºåŠ› | èª¬æ˜Ž | ä½œæ¥­ |
|-------------|------|------|------|------|
| `/spot-profiler` | `spot_aggregators` | `spot_results` | ã‚¹ãƒãƒƒãƒˆéŒ²éŸ³ã®å¿ƒç†åˆ†æž | æ—¢å­˜Scorerã‹ã‚‰ç§»æ¤ |
| `/daily-profiler` | `spot_results`ï¼ˆ1æ—¥åˆ†ï¼‰ | `summary_daily` | æ—¥æ¬¡ç´¯ç©åˆ†æž | æ—¢å­˜Scorerã‹ã‚‰ç§»æ¤ |
| `/weekly-profiler` | `summary_daily`ï¼ˆ7æ—¥åˆ†ï¼‰ | `summary_weekly` | é€±æ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æž | ðŸ†•æ–°è¦å®Ÿè£… |
| `/monthly-profiler` | `summary_daily`ï¼ˆ30æ—¥åˆ†ï¼‰ | `summary_monthly` | æœˆæ¬¡é•·æœŸåˆ†æž | ðŸ†•æ–°è¦å®Ÿè£… |

---

**3. Lambdaé–¢æ•°ã®ä¿®æ­£**

`audio-worker` Lambdaé–¢æ•°:
- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå¤‰æ›´: `/analyze-timeblock` â†’ `/spot-profiler`
- URLå¤‰æ›´: `https://api.hey-watch.me/vibe-analysis/scorer/` â†’ `https://api.hey-watch.me/profiler/`

**æŽ¨å®šä½œæ¥­æ™‚é–“**: 30åˆ†

---

### â³ Phase 5æœªç€æ‰‹: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´è¡¨ç¤º

- â³ iOS ã‚¢ãƒ—ãƒª: å„resultsãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»è¡¨ç¤º
- â³ Web ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰: åŒæ§˜ï¼ˆå„ªå…ˆåº¦ä½Žãƒ»ä¼‘æ­¢ä¸­ï¼‰

**æŽ¨å®šä½œæ¥­æ™‚é–“**: 3-4æ™‚é–“

---

## ðŸš€ æ¬¡ã®ã‚¿ã‚¹ã‚¯ï¼ˆå„ªå…ˆåº¦é †ï¼‰

### Task 1: Profiler APIæ–°è¦ä½œæˆï¼ˆæœ€å„ªå…ˆï¼‰

**ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ»åŸºæœ¬æ§‹é€ ä½œæˆ**

```bash
cd /Users/kaya.matsumoto/projects/watchme/api
mkdir -p profiler/{endpoints,services}
cd profiler
```

---

**ã‚¹ãƒ†ãƒƒãƒ—2: æ—¢å­˜Scorerã‹ã‚‰ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç§»æ¤**

å‚è€ƒãƒ•ã‚¡ã‚¤ãƒ«:
- `/Users/kaya.matsumoto/projects/watchme/api/vibe-analysis/scorer/main.py`
- `/Users/kaya.matsumoto/projects/watchme/api/vibe-analysis/scorer/llm_providers.py`
- `/Users/kaya.matsumoto/projects/watchme/api/vibe-analysis/scorer/supabase_client.py`

ç§»æ¤å†…å®¹:
1. `llm_providers.py` â†’ `services/llm_client.py`
2. `supabase_client.py` â†’ `services/supabase_client.py`
3. `/analyze-timeblock` â†’ `endpoints/spot_profiler.py`
4. `/analyze-dashboard-summary` â†’ `endpoints/daily_profiler.py`

---

**ã‚¹ãƒ†ãƒƒãƒ—3: æ–°è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…**

`endpoints/weekly_profiler.py`:
```python
@router.post("/weekly-profiler")
async def analyze_weekly(request: WeeklyProfilerRequest):
    """
    1é€±é–“åˆ†ã®summary_dailyã‚’å–å¾—
    é€±æ¬¡åˆ†æžãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
    LLMå®Ÿè¡Œ
    summary_weeklyã«ä¿å­˜
    """
```

`endpoints/monthly_profiler.py`:
```python
@router.post("/monthly-profiler")
async def analyze_monthly(request: MonthlyProfilerRequest):
    """
    1ãƒ¶æœˆåˆ†ã®summary_dailyã‚’å–å¾—
    æœˆæ¬¡åˆ†æžãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
    LLMå®Ÿè¡Œ
    summary_monthlyã«ä¿å­˜
    """
```

---

**ã‚¹ãƒ†ãƒƒãƒ—4: Dockerãƒ»CI/CDè¨­å®š**

1. `docker-compose.prod.yml` ä½œæˆ
2. `Dockerfile.prod` ä½œæˆ
3. `.github/workflows/deploy-to-ecr.yml` ä½œæˆ
4. systemdã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

---

**ã‚¹ãƒ†ãƒƒãƒ—5: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»å‹•ä½œç¢ºèª**

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ
docker-compose up --build

# æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤
git add .
git commit -m "feat: Create Profiler API with 4 endpoints"
git push origin main
```

---

### Task 2: Lambdaé–¢æ•°ä¿®æ­£

`audio-worker` ã®ä¿®æ­£:
- Scorer APIå‘¼ã³å‡ºã— â†’ Profiler APIå‘¼ã³å‡ºã—ã«å¤‰æ›´
- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `/spot-profiler`
- URL: `https://api.hey-watch.me/profiler/spot-profiler`

---

### Task 3: iOSè¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…

å„resultsãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—:
- `spot_results`: ã‚¹ãƒãƒƒãƒˆåˆ†æžçµæžœ
- `summary_daily`: æ—¥æ¬¡åˆ†æžçµæžœ
- `summary_weekly`: é€±æ¬¡åˆ†æžçµæžœ
- `summary_monthly`: æœˆæ¬¡åˆ†æžçµæžœ

---

## ðŸ”§ é–‹ç™ºãƒ¡ãƒ¢

### ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¤‰æ›

**Python (Aggregator API)**:
```python
import pytz
from datetime import datetime

# UTC to JST
utc_time = datetime(2025, 11, 11, 12, 31, 1, tzinfo=pytz.UTC)
jst = pytz.timezone('Asia/Tokyo')
local_time = utc_time.astimezone(jst)
# â†’ 2025-11-11 21:31:01+09:00
```

**Swift (iOS)**:
```swift
let utcTime = Date()  // UTC
let timezone = TimeZone(identifier: "Asia/Tokyo")!
let formatter = DateFormatter()
formatter.timeZone = timezone
let localString = formatter.string(from: utcTime)
```

---

## ðŸ“ å¤‰æ›´å±¥æ­´

### 2025-11-12 åˆå¾Œã‚»ãƒƒã‚·ãƒ§ãƒ³ - Phase 3å®Œäº† ðŸŽ‰

- **Aggregator APIæœ¬ç•ªç¨¼åƒé–‹å§‹**:
  - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `https://api.hey-watch.me/aggregator/spot`
  - å‡¦ç†æ™‚é–“: 1-2ç§’
  - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé•·: ç´„4700æ–‡å­—

- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿®æ­£**:
  - `spot_aggregators` ãƒ†ãƒ¼ãƒ–ãƒ«ä¿®æ­£å®Œäº†
  - ã‚«ãƒ©ãƒ åå¤‰æ›´: `aggregated_prompt` â†’ `prompt`, `aggregated_at` â†’ `created_at`
  - ä¸è¦ã‚«ãƒ©ãƒ å‰Šé™¤: `local_date`, `local_time`ï¼ˆUTCçµ±ä¸€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¯¾å¿œï¼‰
  - RLSç„¡åŠ¹åŒ–å®Œäº†

- **Nginxè¨­å®šè¿½åŠ **:
  - `/aggregator/` â†’ `http://localhost:8050/aggregator/`
  - proxy_passè¨­å®šä¿®æ­£ï¼ˆFastAPIã®å†…éƒ¨ãƒ‘ã‚¹æ§‹é€ ã«å¯¾å¿œï¼‰

- **ã‚³ãƒ¼ãƒ‰ä¿®æ­£**:
  - UTCçµ±ä¸€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¯¾å¿œ
  - `local_date`, `local_time` ã®è¨ˆç®—ãƒ»ä¿å­˜å‡¦ç†å‰Šé™¤
  - ã‚«ãƒ©ãƒ åã‚’ `prompt` ã«å¤‰æ›´

- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**:
  - `/api/aggregator/README.md` å…¨é¢æ›´æ–°
  - æœ¬ç•ªç’°å¢ƒæƒ…å ±ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ 

---

### 2025-11-12 åˆå‰ã‚»ãƒƒã‚·ãƒ§ãƒ³ - 3ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆã®æ˜Žç¢ºåŒ– ðŸŽ‰

- **é‡è¦ãªè¨­è¨ˆæ€æƒ³ã®å†ç¢ºèª**:
  - 3ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£: Feature Extraction â†’ Aggregation â†’ **Profiler**
  - Profiler APIãŒæœªä½œæˆã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
  - æ—¢å­˜Scorer APIã¯æ—§ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã¾ã¾ï¼ˆProfiler APIã«ç§»è¡ŒãŒå¿…è¦ï¼‰

- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…¨é¢ãƒªãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ«**:
  - ãƒ•ã‚¡ã‚¤ãƒ«åå¤‰æ›´: `SPOT_RECORDING_MIGRATION_GUIDE.md` â†’ `ARCHITECTURE_AND_MIGRATION_GUIDE.md`
  - 3ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆæ€æƒ³ã®è©³ç´°èª¬æ˜Žã‚’è¿½åŠ 
  - Profiler APIï¼ˆ4ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰ã®è¨­è¨ˆä»•æ§˜ã‚’æ˜Žè¨˜
  - summary_weekly, summary_monthly ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚­ãƒ¼ãƒžã‚’è¿½åŠ 
  - æ®‹ã‚¿ã‚¹ã‚¯ã‚’å†æ•´ç†ï¼ˆProfiler APIæ–°è¦ä½œæˆãŒæœ€å„ªå…ˆï¼‰

- **é€²æ—ã®å†è©•ä¾¡**:
  - Phase 1-3: å®Œäº†ï¼ˆ80%ï¼‰âœ…
  - Phase 4: é€²è¡Œä¸­ï¼ˆæ®‹ã‚Š20%ï¼‰ðŸš§
    - Profiler APIæ–°è¦ä½œæˆï¼ˆæœªç€æ‰‹ï¼‰
    - 4ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…ï¼ˆ2ã¤ã¯ç§»æ¤ã€2ã¤ã¯æ–°è¦ï¼‰
  - Phase 5: æœªç€æ‰‹â³

---

### 2025-11-12 13:00-13:50 - Phase 2-3 å®Œäº† ðŸŽ‰

- Emotion Feature Extractor v2ä¿®æ­£å®Œäº†
- Vibe Transcriberä¿®æ­£å®Œäº†ï¼ˆãƒã‚°ä¿®æ­£2å›žï¼‰
- Aggregator APIä¿®æ­£å®Œäº†ï¼ˆASR+SED+SERçµ±åˆï¼‰

---

### 2025-11-12 00:00-01:00 - Phase 2 é€²è¡Œä¸­

- Vibe Aggregator APIä¿®æ­£å®Œäº†: devices.timezoneå¯¾å¿œ + UTCâ†’ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“å¤‰æ›
- Behavior Featureså‹•ä½œç¢ºèª: spot_featuresã¸ã®ãƒ‡ãƒ¼ã‚¿ä¿å­˜æˆåŠŸ ðŸŽ‰
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿®æ­£: spot_featuresãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¸è¶³ã‚«ãƒ©ãƒ è¿½åŠ  + RLSç„¡åŠ¹åŒ–

---

### 2025-11-11 æœ€çµ‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ - Phase 1 å®Œäº†

- Vault API: `local_datetime` å‰Šé™¤ + S3ãƒ‘ã‚¹ç§’å˜ä½ç²¾åº¦åŒ–ï¼ˆ`{HH-MM-SS}` å½¢å¼ï¼‰
- Vibe Transcriber, Behavior Features, Emotion Features: `spot_features` ç§»è¡Œå®Œäº†
- S3ãƒ‘ã‚¹æ§‹é€ ã‚’30åˆ†ãƒ–ãƒ­ãƒƒã‚¯ã‹ã‚‰ç§’å˜ä½ç²¾åº¦ã«å¤‰æ›´ï¼ˆä¸Šæ›¸ãå•é¡Œã‚’è§£æ±ºï¼‰

---

### 2025-11-11 22:30 - UTCçµ±ä¸€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¸ã®æ–¹é‡è»¢æ›

- `local_datetime` å»ƒæ­¢ã€UTCçµ±ä¸€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ç§»è¡Œ
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿®æ­£: `local_datetime` ã‚«ãƒ©ãƒ å‰Šé™¤
- iOSã‚¢ãƒ—ãƒªä¿®æ­£: UTCé€ä¿¡ã«å¤‰æ›´

---

## ðŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ§‹æˆ](./README.md)
- [å‡¦ç†ãƒ•ãƒ­ãƒ¼è©³ç´°](./PROCESSING_ARCHITECTURE.md)
- [æŠ€è¡“ä»•æ§˜](./TECHNICAL_REFERENCE.md)
- [é‹ç”¨ã‚¬ã‚¤ãƒ‰](./OPERATIONS_GUIDE.md)

---

**ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€WatchMeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åŒ…æ‹¬çš„ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»ç§»è¡Œã‚¬ã‚¤ãƒ‰ã§ã™ã€‚**
