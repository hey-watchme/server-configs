# WatchMe プラットフォーム コスト管理

**最終更新**: 2025-11-21

このドキュメントは、WatchMeプラットフォームの運用コストを一元管理し、ユーザー数増加時のコストシミュレーションを行うためのものです。

---

## 📊 コスト概要（現在）

### 総月額コスト（推定）
| カテゴリ | 月額（USD） | 月額（JPY）※ | 備考 |
|---------|-----------|------------|------|
| **AWS** | $48.00 | ¥7,440 | EC2 + S3 + Lambda + SQS |
| **Groq API** | $0.00 → **要確認** | ¥0 → **要確認** | レート制限対策で有料プラン移行予定 |
| **Deepgram API** | **要確認** | **要確認** | 音声文字起こし（Transcriber） |
| **Supabase** | $0.00 | ¥0 | 無料プラン |
| **Vercel** | $0.00 | ¥0 | 無料プラン |
| **GitHub** | $0.00 | ¥0 | 無料プラン |
| **合計** | **$48.00+** | **¥7,440+** | 1ユーザー運用時（LLM API料金別途） |

※為替レート: 1 USD = 155 JPY（2025年11月概算）

---

## 🌩️ AWS コスト詳細

### EC2（コンピューティング）

#### 現在の構成
- **インスタンスタイプ**: t4g.large（ARM64 Graviton2）
- **リージョン**: ap-southeast-2（シドニー）※東京へ移行予定
- **vCPU**: 2コア
- **メモリ**: 8GB RAM
- **ストレージ**: 30GB gp3 SSD
- **稼働時間**: 24時間365日

#### 料金
| 項目 | 料金 | 計算式 |
|-----|------|--------|
| **インスタンス料金** | $45.99/月 | $0.0632/時間 × 730時間 |
| **EBSストレージ（30GB）** | $2.40/月 | $0.08/GB × 30GB |
| **合計** | **$48.39/月** | - |

#### 過去のインスタンス履歴
| 期間 | インスタンスタイプ | vCPU | RAM | 月額 | 理由 |
|------|------------------|------|-----|------|------|
| ～2025-09-19 | t4g.small | 2 | 2GB | $13.30/月 | 初期構成 |
| 2025-09-19～ | t4g.large | 2 | 8GB | $45.99/月 | メモリ不足対策 |

#### スケーリングオプション（将来検討）
| インスタンスタイプ | vCPU | RAM | 月額 | 適用ケース |
|------------------|------|-----|------|-----------|
| t4g.small | 2 | 2GB | $13.30 | 開発・テスト環境 |
| t4g.medium | 2 | 4GB | $26.60 | 軽量本番環境（10ユーザー程度） |
| **t4g.large** | 2 | 8GB | **$45.99** | **現在の構成** |
| t4g.xlarge | 4 | 16GB | $91.98 | 50ユーザー以上 |
| t4g.2xlarge | 8 | 32GB | $183.96 | 100ユーザー以上 |

---

### S3（ストレージ）

#### 現在の使用状況
- **バケット名**: watchme-vault
- **リージョン**: ap-southeast-2（シドニー）
- **総容量**: 7.0 GB（2025-10-19時点）
- **ストレージクラス**: S3 Standard

#### 料金体系（ap-southeast-2）
- **ストレージ料金**: $0.025/GB/月（推定）
- **データ転送（OUT）**: $0.140/GB（最初の10TB）
- **APIリクエスト（PUT/POST）**: $0.0055/1,000リクエスト
- **APIリクエスト（GET/SELECT）**: $0.00044/1,000リクエスト

#### 現在のコスト
| 項目 | 使用量 | 単価 | 月額（USD） | 月額（JPY） |
|-----|--------|------|-----------|-----------|
| ストレージ | 7 GB | $0.025/GB | $0.175 | ¥27 |
| データ転送（OUT） | - | - | - | - |
| APIリクエスト | - | - | - | - |
| **合計** | - | - | **$0.18** | **¥28** |

#### データ増加率
- **1ユーザーあたり**: 2.6 GB/月
- **ファイル形式**: 音声ファイル（.wav）
- **保存サイクル**: 30分ごとにアップロード

---

### ECR（Container Registry）

#### 現在の使用状況
- **リポジトリ数**: 15個
- **総容量**: （未測定）
- **リージョン**: ap-southeast-2（シドニー）

#### 料金体系
- **ストレージ料金**: $0.10/GB/月
- **データ転送（OUT）**: $0.114/GB

#### 推定コスト
| 項目 | 使用量 | 単価 | 月額（USD） | 備考 |
|-----|--------|------|-----------|------|
| ストレージ | （未測定） | $0.10/GB | （未測定） | 後で調査 |

---

### Lambda（サーバーレス）

#### 現在の使用状況
- **関数数**: 5個（稼働中）
- **実行頻度**:
  - audio-processor: S3アップロードごと（約48回/日/ユーザー）
  - audio-worker: SQSトリガー（約48回/日/ユーザー）
  - dashboard-summary-worker: SQSトリガー（約48回/日/ユーザー）
  - dashboard-analysis-worker: SQSトリガー（約48回/日/ユーザー）
  - weekly-profile-worker: EventBridge（1回/日）
- **リージョン**: ap-southeast-2（シドニー）

#### 料金体系（ap-southeast-2）
- **リクエスト料金**: $0.20/100万リクエスト
- **実行時間料金**: $0.0000166667/GB秒
- **無料枠**: 100万リクエスト/月、40万GB秒/月

#### 推定コスト（1ユーザー）
| 項目 | 使用量/月 | 単価 | 月額（USD） | 備考 |
|-----|----------|------|-----------|------|
| リクエスト | 約6,000回 | $0.20/100万 | $0.00 | 無料枠内（100万/月） |
| 実行時間（512MB） | 約50,000秒 | $0.0000083/秒 | $0.42 | 無料枠内（40万GB秒/月） |
| **合計** | - | - | **$0.42** | **ほぼ無料枠内** |

**10ユーザー時**: 約$4.20/月（無料枠を超える）
**100ユーザー時**: 約$42.00/月

---

### EventBridge（イベント管理）

#### 現在の使用状況
- **ルール数**: 3個（稼働中）
  - janitor-trigger: 6時間ごと（4回/日）
  - demo-generator-trigger: 30分ごと（48回/日）
  - weekly-profile-daily-trigger: 毎日00:00 JST（1回/日）

#### 料金体系
- **カスタムイベント**: $1.00/100万イベント
- **無料枠**: 最初の1400万イベント/月

#### 推定コスト
| 項目 | 使用量/月 | 単価 | 月額（USD） | 備考 |
|-----|----------|------|-----------|------|
| janitor-trigger | 120イベント | - | $0.00 | 無料枠内 |
| demo-generator-trigger | 1,440イベント | - | $0.00 | 無料枠内 |
| weekly-profile-trigger | 30イベント | - | $0.00 | 無料枠内 |
| **合計** | **1,590イベント/月** | - | **$0.00** | **無料枠内** |

---

### SQS（メッセージキュー）

#### 現在の使用状況
- **キュー数**: 3個（稼働中）
  - audio-processing-queue: 音声処理トリガー（約48メッセージ/日/ユーザー）
  - dashboard-summary-queue: Daily集計トリガー（約48メッセージ/日/ユーザー）
  - dashboard-analysis-queue: Daily分析トリガー（約48メッセージ/日/ユーザー）

#### 料金体系
- **Standard Queue**: $0.40/100万リクエスト
- **無料枠**: 100万リクエスト/月

#### 推定コスト（1ユーザー）
| 項目 | 使用量/月 | 単価 | 月額（USD） | 備考 |
|-----|----------|------|-----------|------|
| SQSリクエスト | 約4,320回 | $0.40/100万 | $0.00 | 無料枠内 |

**10ユーザー時**: 約43,200リクエスト/月 → $0.02/月
**100ユーザー時**: 約432,000リクエスト/月 → $0.17/月

---

### その他のAWSサービス

#### データ転送（Inter-Region）
| 項目 | 使用量 | 単価 | 月額（USD） | 備考 |
|-----|--------|------|-----------|------|
| データ転送 | - | - | （未測定） | リージョン間通信 |

#### CloudWatch（監視）
| 項目 | 使用量 | 単価 | 月額（USD） | 備考 |
|-----|--------|------|-----------|------|
| ログ保存 | - | - | $0.00 | 無料枠内 |

---

## 🤖 LLM / ASR API コスト

### Groq API（LLM分析）

#### 現在の使用状況
- **用途**: Profiler API（Spot/Daily/Weekly分析）
- **モデル**: openai/gpt-oss-120b（reasoning model）
- **プラン**: Free Tier
- **レート制限**: 20万トークン/日

#### 料金体系
| プラン | 月額 | トークン/日 | 備考 |
|-------|------|-----------|------|
| **Free** | **$0** | 20万 | **現在** |
| Paid（要確認） | 未定 | 無制限 | レート制限対策で移行予定 |

#### 使用量（1ユーザー）
- **Spot分析**: 約48回/日 × 5,610トークン = 約270,000トークン/日
- **Daily分析**: 約48回/日 × 3,000トークン（推定） = 約144,000トークン/日
- **Weekly分析**: 1回/日 × 5,610トークン = 約5,610トークン/日
- **合計**: 約420,000トークン/日 → **無料枠を超過（約2.1倍）**

#### 推定コスト
| 項目 | 使用量 | 単価 | 月額（USD） | 備考 |
|-----|--------|------|-----------|------|
| Groq API（Free） | 420k トークン/日 | - | $0.00 | **レート制限により処理不可** |
| Groq API（Paid） | 420k トークン/日 | **要確認** | **要確認** | **有料プラン移行必須** |

**対応方針**:
1. ✅ **有料プランへアップグレード**（Groqの料金プラン確認）
2. ⏳ 別のLLMプロバイダーに切り替え（OpenAI、Claude等）
3. ⏳ プロンプトサイズの最適化（トークン削減）

---

### Deepgram API（音声文字起こし）

#### 現在の使用状況
- **用途**: Vibe Transcriber API（音声文字起こし）
- **モデル**: nova-2
- **プラン**: Pay-As-You-Go（初回$200クレジット利用中）
- **処理速度**: 2.96秒/録音

#### 料金体系
- **Pre-recorded Audio**: $0.0043/分（nova-2モデル）
- **初回クレジット**: $200（新規アカウント）

#### 使用量（1ユーザー）
- **録音数**: 48回/日
- **録音時間**: 1分/録音
- **月間**: 48分/日 × 30日 = 1,440分/月
- **月額コスト**: 1,440分 × $0.0043 = **$6.19/月**

**10ユーザー時**: 14,400分/月 → $61.90/月
**100ユーザー時**: 144,000分/月 → $619.20/月

**初回クレジット消費ペース**:
- 1ユーザー: $200 ÷ $6.19/月 = 約32ヶ月分
- 10ユーザー: $200 ÷ $61.90/月 = 約3.2ヶ月分

#### 推定コスト
| 項目 | 使用量/月 | 単価 | 月額（USD） | 備考 |
|-----|----------|------|-----------|------|
| Deepgram API | 1,440分 | $0.0043/分 | $6.19 | 初回$200クレジット内 |

**注意**: 初回クレジット消費後、有料課金が開始されます。

---

## 📱 Supabase コスト

### 現在のプラン
- **プラン**: Free Tier
- **データベース容量**: 500MB（制限）
- **API リクエスト**: 無制限
- **認証ユーザー数**: 50,000（制限）

### 料金体系
| プラン | 月額（USD） | DB容量 | 帯域幅 | 適用ケース |
|-------|-----------|--------|--------|-----------|
| **Free** | **$0** | 500MB | 5GB | **現在** |
| Pro | $25 | 8GB | 250GB | 有料プラン移行時 |
| Team | $599 | 無制限 | 無制限 | エンタープライズ |

### 現在のコスト
| 項目 | 月額（USD） | 月額（JPY） | 備考 |
|-----|-----------|-----------|------|
| Supabase | **$0.00** | **¥0** | 無料プラン |

### スケーリング時の推定コスト
- **10ユーザー**: $0（無料枠内）
- **100ユーザー**: $25/月（Proプラン移行）
- **1,000ユーザー**: $25/月 or $599/月（データ量次第）

---

## 🌐 Vercel コスト

### 現在のプラン
- **プラン**: Hobby（無料）
- **デプロイ数**: 無制限
- **帯域幅**: 100GB/月
- **ビルド時間**: 100時間/月

### 料金体系
| プラン | 月額（USD） | 帯域幅 | ビルド時間 | 適用ケース |
|-------|-----------|--------|-----------|-----------|
| **Hobby** | **$0** | 100GB | 100時間 | **現在** |
| Pro | $20 | 1TB | 400時間 | 商用サービス |
| Enterprise | カスタム | 無制限 | 無制限 | 大規模運用 |

### 現在のコスト
| 項目 | 月額（USD） | 月額（JPY） | 備考 |
|-----|-----------|-----------|------|
| Vercel | **$0.00** | **¥0** | 無料プラン |

---

## 🐙 GitHub コスト

### 現在のプラン
- **プラン**: Free
- **リポジトリ数**: 無制限
- **GitHub Actions**: 2,000分/月（無料枠）
- **ストレージ**: 500MB

### 料金体系
| プラン | 月額（USD） | Actions | ストレージ | 適用ケース |
|-------|-----------|---------|-----------|-----------|
| **Free** | **$0** | 2,000分 | 500MB | **現在** |
| Team | $4/ユーザー | 3,000分 | 2GB | チーム開発 |
| Enterprise | $21/ユーザー | 50,000分 | 50GB | 大規模開発 |

### 現在のコスト
| 項目 | 月額（USD） | 月額（JPY） | 備考 |
|-----|-----------|-----------|------|
| GitHub | **$0.00** | **¥0** | 無料プラン |

---

## 📈 ユーザー数別コストシミュレーション

### 前提条件
- **1ユーザーあたりのS3増加量**: 2.6 GB/月
- **Janitor API**: 未導入（削除なし）
- **EC2**: 現在のt4g.large維持
- **為替レート**: 1 USD = 155 JPY

### 月額コスト試算

| ユーザー数 | S3容量（累積12ヶ月） | S3コスト | EC2コスト | AWS合計 | 総コスト（月額） |
|-----------|---------------------|---------|----------|---------|----------------|
| **1人** | 31.2 GB | $0.78 | $48.39 | $49.17 | **¥7,621** |
| **5人** | 156 GB | $3.90 | $48.39 | $52.29 | **¥8,105** |
| **10人** | 312 GB | $7.80 | $48.39 | $56.19 | **¥8,709** |
| **50人** | 1,560 GB (1.56 TB) | $39.00 | $48.39 | $87.39 | **¥13,545** |
| **100人** | 3,120 GB (3.12 TB) | $78.00 | $91.98※ | $169.98 | **¥26,347** |

※100ユーザー時はt4g.xlarge（16GB RAM）への移行を推奨

---

## 💡 Janitor API導入によるコスト削減効果

### 削減シナリオ
Janitor APIで**24時間以内に処理済みファイルを削除**すると：

- **保持期間**: 30日 → **1日**（約97%削減）
- **ストレージ削減率**: **最大97%削減**

### 削減後のコスト（10ユーザーの場合）

| 項目 | Janitor導入前 | Janitor導入後 | 削減額 |
|-----|-------------|-------------|-------|
| 月間増加量 | 26 GB | 0.87 GB（1日分のみ） | -25.13 GB |
| 12ヶ月後の累積 | 312 GB | 10.4 GB | -301.6 GB |
| S3月額コスト（12ヶ月後） | $7.80 (¥1,209) | $0.26 (¥40) | **-$7.54 (-¥1,169)** |
| 総月額コスト | $56.19 (¥8,709) | $48.65 (¥7,540) | **-$7.54 (-¥1,169)** |

### 年間削減額（10ユーザー）
- **年間削減**: $90.48（¥14,024）

---

## 🚨 コストアラートとアクション

### 注意すべき閾値

| 項目 | 注意レベル | 警告レベル | 危険レベル | アクション |
|-----|-----------|-----------|-----------|-----------|
| **月額コスト** | $100 | $200 | $300 | コスト最適化検討 |
| **S3容量** | 100 GB | 500 GB | 1 TB | Janitor API導入 |
| **EC2メモリ使用率** | 70% | 85% | 95% | インスタンスアップグレード |
| **Supabase DB容量** | 300 MB | 450 MB | 500 MB | Proプラン移行 |

### コスト削減施策

#### 短期施策（即時実施可能）
1. ✅ **Janitor API導入** - S3コスト97%削減
2. ⏳ **リージョン移行（東京）** - レイテンシ85%改善（コストは同等）
3. ⏳ **不要なECRイメージ削除** - ストレージコスト削減

#### 中期施策（3ヶ月以内）
1. ⏳ **EC2リザーブドインスタンス** - 最大72%割引（1年契約）
2. ⏳ **S3 Intelligent-Tiering** - アクセス頻度に応じた自動階層化
3. ⏳ **CloudFrontキャッシュ最適化** - データ転送コスト削減

#### 長期施策（6ヶ月以上）
1. ⏳ **マルチクラウド検討** - AWS + GCP の比較
2. ⏳ **アーキテクチャ最適化** - サーバーレス移行検討
3. ⏳ **自動スケーリング** - 需要に応じたリソース調整

---

## 📝 コスト追跡ログ

### 2025-11-21
- **EC2**: t4g.large - $48.39/月
- **S3**: 7.0 GB - $0.18/月（Janitor導入後は約97%削減）
- **Lambda**: 約$0.42/月（1ユーザー、ほぼ無料枠内）
- **SQS**: $0.00/月（無料枠内）
- **EventBridge**: $0.00/月（無料枠内）
- **Groq API**: $0.00/月（無料枠、**レート制限により有料プラン移行必須**）
- **Deepgram API**: $6.19/月（初回$200クレジット内）
- **総コスト**: 約$55.00/月（¥8,525）
- **備考**:
  - Weekly Profile機能追加（2025-11-20）
  - Groqレート制限対策必要
  - Deepgramは初回クレジット内（約32ヶ月分）

### 2025-10-19
- **EC2**: t4g.large - $48.39/月
- **S3**: 7.0 GB - $0.18/月
- **総コスト**: $48.57/月（¥7,528）
- **備考**: Janitor API未導入、S3削減前の状態

---

## 🔧 今後の調査項目

### 優先度：高
- [ ] **Groq API有料プランの料金確認**（レート制限対策）
- [ ] **Groq API料金確認後の代替LLM検討**（OpenAI、Claude等）
- [ ] ECRストレージ使用量の測定
- [ ] Lambda実行コストの実測（現在は推定値）

### 優先度：中
- [ ] Deepgramクレジット残高の監視
- [ ] CloudWatch Logsのコスト測定
- [ ] GitHub Actions実行時間の監視
- [ ] データ転送量の詳細測定（S3 OUT）

### 優先度：低
- [ ] リージョン間データ転送コストの測定
- [ ] API Gateway導入の検討とコスト試算
- [ ] CloudFront導入の検討とコスト試算

---

## 📚 参考資料

### AWS料金計算ツール
- [AWS Pricing Calculator](https://calculator.aws/)
- [EC2料金表（ap-southeast-2）](https://aws.amazon.com/ec2/pricing/on-demand/)
- [S3料金表（ap-southeast-2）](https://aws.amazon.com/s3/pricing/)

### コスト最適化ガイド
- [AWS Cost Optimization Best Practices](https://aws.amazon.com/pricing/cost-optimization/)
- [AWS Well-Architected Framework - Cost Optimization](https://docs.aws.amazon.com/wellarchitected/latest/cost-optimization-pillar/welcome.html)

---

## 🚨 緊急対応事項

### Groq APIレート制限対策（最優先）

**現状**:
- 現在のトークン使用量: 約420,000トークン/日
- 無料枠: 200,000トークン/日
- **超過率**: 約210%（2.1倍）

**影響**:
- 毎日00:00（JST）前後にWeekly Profile処理が失敗
- Spot/Daily分析も断続的に失敗

**対応オプション**:
1. **Groq有料プランへアップグレード**
   - 料金: 要確認（Groq Console）
   - URL: https://console.groq.com/settings/billing

2. **OpenAI APIへ切り替え**
   - gpt-4o: $2.50/1M input tokens、$10/1M output tokens
   - 月額推定: 約$10-15/月（1ユーザー）

3. **Claude APIへ切り替え**
   - Claude 3.5 Sonnet: $3/1M input tokens、$15/1M output tokens
   - 月額推定: 約$12-20/月（1ユーザー）

**推奨**: まずGroqの有料プランを確認し、コストが高ければOpenAI/Claudeを検討

---

**最終更新**: 2025-11-21
**次回レビュー**: 2025-12-21（毎月21日）
