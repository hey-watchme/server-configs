# WatchMe プラットフォーム コスト管理

**最終更新**: 2025-10-19

このドキュメントは、WatchMeプラットフォームの運用コストを一元管理し、ユーザー数増加時のコストシミュレーションを行うためのものです。

---

## 📊 コスト概要（現在）

### 総月額コスト（推定）
| カテゴリ | 月額（USD） | 月額（JPY）※ | 備考 |
|---------|-----------|------------|------|
| **AWS** | $48.00 | ¥7,440 | EC2 + S3 + その他 |
| **Supabase** | $0.00 | ¥0 | 無料プラン |
| **Vercel** | $0.00 | ¥0 | 無料プラン |
| **GitHub** | $0.00 | ¥0 | 無料プラン |
| **合計** | **$48.00** | **¥7,440** | 1ユーザー運用時 |

※為替レート: 1 USD = 155 JPY（2025年10月概算）

---

## 🌩️ AWS コスト詳細

### EC2（コンピューティング）

#### 現在の構成
- **インスタンスタイプ**: t4g.large（ARM64 Graviton2）
- **リージョン**: ap-southeast-2（シドニー）※東京へ移行予定
- **vCPU**: 2コア
- **メモリ**: 8GB RAM
- **ストレージ**: 30GB gp3 SSD
- **稼働時間**: 24時間365日

#### 料金
| 項目 | 料金 | 計算式 |
|-----|------|--------|
| **インスタンス料金** | $45.99/月 | $0.0632/時間 × 730時間 |
| **EBSストレージ（30GB）** | $2.40/月 | $0.08/GB × 30GB |
| **合計** | **$48.39/月** | - |

#### 過去のインスタンス履歴
| 期間 | インスタンスタイプ | vCPU | RAM | 月額 | 理由 |
|------|------------------|------|-----|------|------|
| ～2025-09-19 | t4g.small | 2 | 2GB | $13.30/月 | 初期構成 |
| 2025-09-19～ | t4g.large | 2 | 8GB | $45.99/月 | メモリ不足対策 |

#### スケーリングオプション（将来検討）
| インスタンスタイプ | vCPU | RAM | 月額 | 適用ケース |
|------------------|------|-----|------|-----------|
| t4g.small | 2 | 2GB | $13.30 | 開発・テスト環境 |
| t4g.medium | 2 | 4GB | $26.60 | 軽量本番環境（10ユーザー程度） |
| **t4g.large** | 2 | 8GB | **$45.99** | **現在の構成** |
| t4g.xlarge | 4 | 16GB | $91.98 | 50ユーザー以上 |
| t4g.2xlarge | 8 | 32GB | $183.96 | 100ユーザー以上 |

---

### S3（ストレージ）

#### 現在の使用状況
- **バケット名**: watchme-vault
- **リージョン**: ap-southeast-2（シドニー）
- **総容量**: 7.0 GB（2025-10-19時点）
- **ストレージクラス**: S3 Standard

#### 料金体系（ap-southeast-2）
- **ストレージ料金**: $0.025/GB/月（推定）
- **データ転送（OUT）**: $0.140/GB（最初の10TB）
- **APIリクエスト（PUT/POST）**: $0.0055/1,000リクエスト
- **APIリクエスト（GET/SELECT）**: $0.00044/1,000リクエスト

#### 現在のコスト
| 項目 | 使用量 | 単価 | 月額（USD） | 月額（JPY） |
|-----|--------|------|-----------|-----------|
| ストレージ | 7 GB | $0.025/GB | $0.175 | ¥27 |
| データ転送（OUT） | - | - | - | - |
| APIリクエスト | - | - | - | - |
| **合計** | - | - | **$0.18** | **¥28** |

#### データ増加率
- **1ユーザーあたり**: 2.6 GB/月
- **ファイル形式**: 音声ファイル（.wav）
- **保存サイクル**: 30分ごとにアップロード

---

### ECR（Container Registry）

#### 現在の使用状況
- **リポジトリ数**: 15個
- **総容量**: （未測定）
- **リージョン**: ap-southeast-2（シドニー）

#### 料金体系
- **ストレージ料金**: $0.10/GB/月
- **データ転送（OUT）**: $0.114/GB

#### 推定コスト
| 項目 | 使用量 | 単価 | 月額（USD） | 備考 |
|-----|--------|------|-----------|------|
| ストレージ | （未測定） | $0.10/GB | （未測定） | 後で調査 |

---

### Lambda（サーバーレス）

#### 現在の使用状況
- **関数数**: （未デプロイ）
- **実行時間**: -
- **リージョン**: ap-southeast-2（シドニー）

#### 料金体系（ap-southeast-2）
- **リクエスト料金**: $0.20/100万リクエスト
- **実行時間料金**: $0.0000166667/GB秒
- **無料枠**: 100万リクエスト/月、40万GB秒/月

#### 推定コスト
| 項目 | 使用量 | 単価 | 月額（USD） | 備考 |
|-----|--------|------|-----------|------|
| リクエスト | （未デプロイ） | - | $0.00 | 無料枠内 |
| 実行時間 | （未デプロイ） | - | $0.00 | 無料枠内 |

---

### EventBridge（イベント管理）

#### 現在の使用状況
- **ルール数**: 0（Janitor API用に1つ追加予定）
- **実行頻度**: 6時間ごと（予定）

#### 料金体系
- **カスタムイベント**: $1.00/100万イベント
- **無料枠**: 最初の1400万イベント/月

#### 推定コスト
| 項目 | 使用量 | 単価 | 月額（USD） | 備考 |
|-----|--------|------|-----------|------|
| イベント | 120イベント/月 | - | $0.00 | 無料枠内 |

---

### SQS（メッセージキュー）

#### 現在の使用状況
- **キュー数**: （未使用）
- **メッセージ数**: -

#### 料金体系
- **Standard Queue**: $0.40/100万リクエスト
- **無料枠**: 100万リクエスト/月

#### 推定コスト
| 項目 | 使用量 | 単価 | 月額（USD） | 備考 |
|-----|--------|------|-----------|------|
| リクエスト | - | - | $0.00 | 未使用 |

---

### その他のAWSサービス

#### データ転送（Inter-Region）
| 項目 | 使用量 | 単価 | 月額（USD） | 備考 |
|-----|--------|------|-----------|------|
| データ転送 | - | - | （未測定） | リージョン間通信 |

#### CloudWatch（監視）
| 項目 | 使用量 | 単価 | 月額（USD） | 備考 |
|-----|--------|------|-----------|------|
| ログ保存 | - | - | $0.00 | 無料枠内 |

---

## 📱 Supabase コスト

### 現在のプラン
- **プラン**: Free Tier
- **データベース容量**: 500MB（制限）
- **API リクエスト**: 無制限
- **認証ユーザー数**: 50,000（制限）

### 料金体系
| プラン | 月額（USD） | DB容量 | 帯域幅 | 適用ケース |
|-------|-----------|--------|--------|-----------|
| **Free** | **$0** | 500MB | 5GB | **現在** |
| Pro | $25 | 8GB | 250GB | 有料プラン移行時 |
| Team | $599 | 無制限 | 無制限 | エンタープライズ |

### 現在のコスト
| 項目 | 月額（USD） | 月額（JPY） | 備考 |
|-----|-----------|-----------|------|
| Supabase | **$0.00** | **¥0** | 無料プラン |

### スケーリング時の推定コスト
- **10ユーザー**: $0（無料枠内）
- **100ユーザー**: $25/月（Proプラン移行）
- **1,000ユーザー**: $25/月 or $599/月（データ量次第）

---

## 🌐 Vercel コスト

### 現在のプラン
- **プラン**: Hobby（無料）
- **デプロイ数**: 無制限
- **帯域幅**: 100GB/月
- **ビルド時間**: 100時間/月

### 料金体系
| プラン | 月額（USD） | 帯域幅 | ビルド時間 | 適用ケース |
|-------|-----------|--------|-----------|-----------|
| **Hobby** | **$0** | 100GB | 100時間 | **現在** |
| Pro | $20 | 1TB | 400時間 | 商用サービス |
| Enterprise | カスタム | 無制限 | 無制限 | 大規模運用 |

### 現在のコスト
| 項目 | 月額（USD） | 月額（JPY） | 備考 |
|-----|-----------|-----------|------|
| Vercel | **$0.00** | **¥0** | 無料プラン |

---

## 🐙 GitHub コスト

### 現在のプラン
- **プラン**: Free
- **リポジトリ数**: 無制限
- **GitHub Actions**: 2,000分/月（無料枠）
- **ストレージ**: 500MB

### 料金体系
| プラン | 月額（USD） | Actions | ストレージ | 適用ケース |
|-------|-----------|---------|-----------|-----------|
| **Free** | **$0** | 2,000分 | 500MB | **現在** |
| Team | $4/ユーザー | 3,000分 | 2GB | チーム開発 |
| Enterprise | $21/ユーザー | 50,000分 | 50GB | 大規模開発 |

### 現在のコスト
| 項目 | 月額（USD） | 月額（JPY） | 備考 |
|-----|-----------|-----------|------|
| GitHub | **$0.00** | **¥0** | 無料プラン |

---

## 📈 ユーザー数別コストシミュレーション

### 前提条件
- **1ユーザーあたりのS3増加量**: 2.6 GB/月
- **Janitor API**: 未導入（削除なし）
- **EC2**: 現在のt4g.large維持
- **為替レート**: 1 USD = 155 JPY

### 月額コスト試算

| ユーザー数 | S3容量（累積12ヶ月） | S3コスト | EC2コスト | AWS合計 | 総コスト（月額） |
|-----------|---------------------|---------|----------|---------|----------------|
| **1人** | 31.2 GB | $0.78 | $48.39 | $49.17 | **¥7,621** |
| **5人** | 156 GB | $3.90 | $48.39 | $52.29 | **¥8,105** |
| **10人** | 312 GB | $7.80 | $48.39 | $56.19 | **¥8,709** |
| **50人** | 1,560 GB (1.56 TB) | $39.00 | $48.39 | $87.39 | **¥13,545** |
| **100人** | 3,120 GB (3.12 TB) | $78.00 | $91.98※ | $169.98 | **¥26,347** |

※100ユーザー時はt4g.xlarge（16GB RAM）への移行を推奨

---

## 💡 Janitor API導入によるコスト削減効果

### 削減シナリオ
Janitor APIで**24時間以内に処理済みファイルを削除**すると：

- **保持期間**: 30日 → **1日**（約97%削減）
- **ストレージ削減率**: **最大97%削減**

### 削減後のコスト（10ユーザーの場合）

| 項目 | Janitor導入前 | Janitor導入後 | 削減額 |
|-----|-------------|-------------|-------|
| 月間増加量 | 26 GB | 0.87 GB（1日分のみ） | -25.13 GB |
| 12ヶ月後の累積 | 312 GB | 10.4 GB | -301.6 GB |
| S3月額コスト（12ヶ月後） | $7.80 (¥1,209) | $0.26 (¥40) | **-$7.54 (-¥1,169)** |
| 総月額コスト | $56.19 (¥8,709) | $48.65 (¥7,540) | **-$7.54 (-¥1,169)** |

### 年間削減額（10ユーザー）
- **年間削減**: $90.48（¥14,024）

---

## 🚨 コストアラートとアクション

### 注意すべき閾値

| 項目 | 注意レベル | 警告レベル | 危険レベル | アクション |
|-----|-----------|-----------|-----------|-----------|
| **月額コスト** | $100 | $200 | $300 | コスト最適化検討 |
| **S3容量** | 100 GB | 500 GB | 1 TB | Janitor API導入 |
| **EC2メモリ使用率** | 70% | 85% | 95% | インスタンスアップグレード |
| **Supabase DB容量** | 300 MB | 450 MB | 500 MB | Proプラン移行 |

### コスト削減施策

#### 短期施策（即時実施可能）
1. ✅ **Janitor API導入** - S3コスト97%削減
2. ⏳ **リージョン移行（東京）** - レイテンシ85%改善（コストは同等）
3. ⏳ **不要なECRイメージ削除** - ストレージコスト削減

#### 中期施策（3ヶ月以内）
1. ⏳ **EC2リザーブドインスタンス** - 最大72%割引（1年契約）
2. ⏳ **S3 Intelligent-Tiering** - アクセス頻度に応じた自動階層化
3. ⏳ **CloudFrontキャッシュ最適化** - データ転送コスト削減

#### 長期施策（6ヶ月以上）
1. ⏳ **マルチクラウド検討** - AWS + GCP の比較
2. ⏳ **アーキテクチャ最適化** - サーバーレス移行検討
3. ⏳ **自動スケーリング** - 需要に応じたリソース調整

---

## 📝 コスト追跡ログ

### 2025-10-19
- **EC2**: t4g.large - $48.39/月
- **S3**: 7.0 GB - $0.18/月
- **総コスト**: $48.57/月（¥7,528）
- **備考**: Janitor API未導入、S3削減前の状態

---

## 🔧 今後の調査項目

### 優先度：高
- [ ] ECRストレージ使用量の測定
- [ ] データ転送量の詳細測定（S3 OUT）
- [ ] Janitor API導入後のS3削減効果測定

### 優先度：中
- [ ] CloudWatch Logsのコスト測定
- [ ] Lambda実行コストの測定（Janitor導入後）
- [ ] GitHub Actions実行時間の監視

### 優先度：低
- [ ] リージョン間データ転送コストの測定
- [ ] API Gateway導入の検討とコスト試算
- [ ] CloudFront導入の検討とコスト試算

---

## 📚 参考資料

### AWS料金計算ツール
- [AWS Pricing Calculator](https://calculator.aws/)
- [EC2料金表（ap-southeast-2）](https://aws.amazon.com/ec2/pricing/on-demand/)
- [S3料金表（ap-southeast-2）](https://aws.amazon.com/s3/pricing/)

### コスト最適化ガイド
- [AWS Cost Optimization Best Practices](https://aws.amazon.com/pricing/cost-optimization/)
- [AWS Well-Architected Framework - Cost Optimization](https://docs.aws.amazon.com/wellarchitected/latest/cost-optimization-pillar/welcome.html)

---

**最終更新**: 2025-10-19
**次回レビュー**: 2025-11-19（毎月19日）
